(()=>{var Fn=Object.defineProperty,o=(e,t)=>Fn(e,"name",{value:t,configurable:!0}),Cn=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return r=>{for(var l=r.length,d=new Uint8Array((l-(r[l-1]=="=")-(r[l-2]=="="))*3/4|0),m=0,E=0;m<l;){var I=e[r.charCodeAt(m++)],U=e[r.charCodeAt(m++)],A=e[r.charCodeAt(m++)],Z=e[r.charCodeAt(m++)];d[E++]=I<<2|U>>4,d[E++]=U<<4|A>>2,d[E++]=A<<6|Z}return d}})();function Qe(e){return e*Math.PI/180}o(Qe,"deg2rad");function Ut(e){return e*180/Math.PI}o(Ut,"rad2deg");function tt(e,t,r){return t>r?tt(e,r,t):Math.min(Math.max(e,t),r)}o(tt,"clamp");function it(e,t,r){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*r;if(e instanceof S&&t instanceof S||e instanceof oe&&t instanceof oe)return e.lerp(t,r);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}o(it,"lerp");function gt(e,t,r,l,d){return l+(e-t)/(r-t)*(d-l)}o(gt,"map");function Nr(e,t,r,l,d){return tt(gt(e,t,r,l,d),l,d)}o(Nr,"mapc");var S=class Pe{static{o(this,"Vec2")}x=0;y=0;constructor(t=0,r=t){this.x=t,this.y=r}static fromAngle(t){let r=Qe(t);return new Pe(Math.cos(r),Math.sin(r))}static LEFT=new Pe(-1,0);static RIGHT=new Pe(1,0);static UP=new Pe(0,-1);static DOWN=new Pe(0,1);clone(){return new Pe(this.x,this.y)}add(...t){let r=B(...t);return new Pe(this.x+r.x,this.y+r.y)}sub(...t){let r=B(...t);return new Pe(this.x-r.x,this.y-r.y)}scale(...t){let r=B(...t);return new Pe(this.x*r.x,this.y*r.y)}dist(...t){let r=B(...t);return this.sub(r).len()}sdist(...t){let r=B(...t);return this.sub(r).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new Pe(0):this.scale(1/t)}normal(){return new Pe(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let r=B(...t);return Ut(Math.atan2(this.y-r.y,this.x-r.x))}angleBetween(...t){let r=B(...t);return Ut(Math.atan2(this.cross(r),this.dot(r)))}lerp(t,r){return new Pe(it(this.x,t.x,r),it(this.y,t.y,r))}slerp(t,r){let l=this.dot(t),d=this.cross(t),m=Math.atan2(d,l);return this.scale(Math.sin((1-r)*m)).add(t.scale(Math.sin(r*m))).scale(1/d)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new Pe(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new Re(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function B(...e){if(e.length===1){if(e[0]instanceof S)return new S(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new S(...e[0])}return new S(...e)}o(B,"vec2");var oe=class me{static{o(this,"Color")}r=255;g=255;b=255;constructor(t,r,l){this.r=tt(t,0,255),this.g=tt(r,0,255),this.b=tt(l,0,255)}static fromArray(t){return new me(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new me(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return new me(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,r,l){if(r==0)return new me(255*l,255*l,255*l);let d=o((Z,R,z)=>(z<0&&(z+=1),z>1&&(z-=1),z<1/6?Z+(R-Z)*6*z:z<1/2?R:z<2/3?Z+(R-Z)*(2/3-z)*6:Z),"hue2rgb"),m=l<.5?l*(1+r):l+r-l*r,E=2*l-m,I=d(E,m,t+1/3),U=d(E,m,t),A=d(E,m,t-1/3);return new me(Math.round(I*255),Math.round(U*255),Math.round(A*255))}static RED=new me(255,0,0);static GREEN=new me(0,255,0);static BLUE=new me(0,0,255);static YELLOW=new me(255,255,0);static MAGENTA=new me(255,0,255);static CYAN=new me(0,255,255);static WHITE=new me(255,255,255);static BLACK=new me(0,0,0);clone(){return new me(this.r,this.g,this.b)}lighten(t){return new me(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new me(255-this.r,255-this.g,255-this.b)}mult(t){return new me(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,r){return new me(it(this.r,t.r,r),it(this.g,t.g,r),it(this.b,t.b,r))}toHSL(){let t=this.r/255,r=this.g/255,l=this.b/255,d=Math.max(t,r,l),m=Math.min(t,r,l),E=(d+m)/2,I=E,U=E;if(d==m)E=I=0;else{let A=d-m;switch(I=U>.5?A/(2-d-m):A/(d+m),d){case t:E=(r-l)/A+(r<l?6:0);break;case r:E=(l-t)/A+2;break;case l:E=(t-r)/A+4;break}E/=6}return[E,I,U]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function se(...e){if(e.length===0)return new oe(255,255,255);if(e.length===1){if(e[0]instanceof oe)return e[0].clone();if(typeof e[0]=="string")return oe.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return oe.fromArray(e[0])}return new oe(...e)}o(se,"rgb");var Dn=o((e,t,r)=>oe.fromHSL(e,t,r),"hsl2rgb"),ve=class Xi{static{o(this,"Quad")}x=0;y=0;w=1;h=1;constructor(t,r,l,d){this.x=t,this.y=r,this.w=l,this.h=d}scale(t){return new Xi(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new S(this.x,this.y)}clone(){return new Xi(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function pe(e,t,r,l){return new ve(e,t,r,l)}o(pe,"quad");var ke=class et{static{o(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(t){t&&(this.m=t)}static translate(t){return new et([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new et([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=Qe(-t);let r=Math.cos(t),l=Math.sin(t);return new et([1,0,0,0,0,r,-l,0,0,l,r,0,0,0,0,1])}static rotateY(t){t=Qe(-t);let r=Math.cos(t),l=Math.sin(t);return new et([r,0,l,0,0,1,0,0,-l,0,r,0,0,0,0,1])}static rotateZ(t){t=Qe(-t);let r=Math.cos(t),l=Math.sin(t);return new et([r,-l,0,0,l,r,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=Qe(-t);let r=Math.cos(t),l=Math.sin(t),d=this.m[0],m=this.m[1],E=this.m[4],I=this.m[5];return this.m[0]=d*r+m*l,this.m[1]=-d*l+m*r,this.m[4]=E*r+I*l,this.m[5]=-E*l+I*r,this}mult(t){let r=[];for(let l=0;l<4;l++)for(let d=0;d<4;d++)r[l*4+d]=this.m[0*4+d]*t.m[l*4+0]+this.m[1*4+d]*t.m[l*4+1]+this.m[2*4+d]*t.m[l*4+2]+this.m[3*4+d]*t.m[l*4+3];return new et(r)}multVec2(t){return new S(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new S(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new S(r,t/r)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new S(t/r,r)}else return new S(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return Ut(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return Ut(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new S(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new S(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new S(0,0)}invert(){let t=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],l=this.m[9]*this.m[15]-this.m[13]*this.m[11],d=this.m[9]*this.m[14]-this.m[13]*this.m[10],m=this.m[8]*this.m[15]-this.m[12]*this.m[11],E=this.m[8]*this.m[14]-this.m[12]*this.m[10],I=this.m[8]*this.m[13]-this.m[12]*this.m[9],U=this.m[6]*this.m[15]-this.m[14]*this.m[7],A=this.m[5]*this.m[15]-this.m[13]*this.m[7],Z=this.m[5]*this.m[14]-this.m[13]*this.m[6],R=this.m[4]*this.m[15]-this.m[12]*this.m[7],z=this.m[4]*this.m[14]-this.m[12]*this.m[6],y=this.m[5]*this.m[15]-this.m[13]*this.m[7],J=this.m[4]*this.m[13]-this.m[12]*this.m[5],ue=this.m[6]*this.m[11]-this.m[10]*this.m[7],j=this.m[5]*this.m[11]-this.m[9]*this.m[7],D=this.m[5]*this.m[10]-this.m[9]*this.m[6],ie=this.m[4]*this.m[11]-this.m[8]*this.m[7],P=this.m[4]*this.m[10]-this.m[8]*this.m[6],x=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*r-this.m[6]*l+this.m[7]*d,t[4]=-(this.m[4]*r-this.m[6]*m+this.m[7]*E),t[8]=this.m[4]*l-this.m[5]*m+this.m[7]*I,t[12]=-(this.m[4]*d-this.m[5]*E+this.m[6]*I),t[1]=-(this.m[1]*r-this.m[2]*l+this.m[3]*d),t[5]=this.m[0]*r-this.m[2]*m+this.m[3]*E,t[9]=-(this.m[0]*l-this.m[1]*m+this.m[3]*I),t[13]=this.m[0]*d-this.m[1]*E+this.m[2]*I,t[2]=this.m[1]*U-this.m[2]*A+this.m[3]*Z,t[6]=-(this.m[0]*U-this.m[2]*R+this.m[3]*z),t[10]=this.m[0]*y-this.m[1]*R+this.m[3]*J,t[14]=-(this.m[0]*Z-this.m[1]*z+this.m[2]*J),t[3]=-(this.m[1]*ue-this.m[2]*j+this.m[3]*D),t[7]=this.m[0]*ue-this.m[2]*ie+this.m[3]*P,t[11]=-(this.m[0]*j-this.m[1]*ie+this.m[3]*x),t[15]=this.m[0]*D-this.m[1]*P+this.m[2]*x;let L=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let K=0;K<4;K++)for(let q=0;q<4;q++)t[K*4+q]*=1/L;return new et(t)}clone(){return new et([...this.m])}toString(){return this.m.toString()}};function Ji(e,t,r,l=d=>-Math.cos(d)){return e+(l(r)+1)/2*(t-e)}o(Ji,"wave");var Nn=1103515245,On=12345,xr=2147483648,Or=class{static{o(this,"RNG")}seed;constructor(e){this.seed=e}gen(){return this.seed=(Nn*this.seed+On)%xr,this.seed/xr}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new S(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new oe(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof S)return this.genVec2(B(0,0),e[0]);if(e[0]instanceof oe)return this.genColor(se(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof S&&e[1]instanceof S)return this.genVec2(e[0],e[1]);if(e[0]instanceof oe&&e[1]instanceof oe)return this.genColor(e[0],e[1])}}},Zi=new Or(Date.now());function jr(e){return e!=null&&(Zi.seed=e),Zi.seed}o(jr,"randSeed");function ii(...e){return Zi.genAny(...e)}o(ii,"rand");function rs(...e){return Math.floor(ii(...e))}o(rs,"randi");function Ur(e){return ii()<=e}o(Ur,"chance");function Lr(e){return e[rs(e.length)]}o(Lr,"choose");function Gr(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}o(Gr,"testRectRect");function zr(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let r=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(r===0)return null;let l=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/r,d=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/r;return l<0||l>1||d<0||d>1?null:l}o(zr,"testLineLineT");function Ot(e,t){let r=zr(e,t);return r?B(e.p1.x+r*(e.p2.x-e.p1.x),e.p1.y+r*(e.p2.y-e.p1.y)):null}o(Ot,"testLineLine");function Hr(e,t){if(si(e,t.p1)||si(e,t.p2))return!0;let r=e.points();return!!Ot(t,new jt(r[0],r[1]))||!!Ot(t,new jt(r[1],r[2]))||!!Ot(t,new jt(r[2],r[3]))||!!Ot(t,new jt(r[3],r[0]))}o(Hr,"testRectLine");function si(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}o(si,"testRectPoint");function Kr(e,t){let r=t.sub(e.p1),l=e.p2.sub(e.p1);if(Math.abs(r.cross(l))>Number.EPSILON)return!1;let d=r.dot(l)/l.dot(l);return d>=0&&d<=1}o(Kr,"testLinePoint");function ns(e,t){let r=e.p2.sub(e.p1),l=r.dot(r),d=e.p1.sub(t.center),m=2*r.dot(d),E=d.dot(d)-t.radius*t.radius,I=m*m-4*l*E;if(l<=Number.EPSILON||I<0)return!1;if(I==0){let U=-m/(2*l);if(U>=0&&U<=1)return!0}else{let U=(-m+Math.sqrt(I))/(2*l),A=(-m-Math.sqrt(I))/(2*l);if(U>=0&&U<=1||A>=0&&A<=1)return!0}return os(t,e.p1)}o(ns,"testLineCircle");function os(e,t){return e.center.sdist(t)<e.radius*e.radius}o(os,"testCirclePoint");function qr(e,t){let r=t.pts[t.pts.length-1];for(let l of t.pts){if(ns(new jt(r,l),e))return!0;r=l}return os(e,t.pts[0])?!0:as(t,e.center)}o(qr,"testCirclePolygon");function as(e,t){let r=!1,l=e.pts;for(let d=0,m=l.length-1;d<l.length;m=d++)l[d].y>t.y!=l[m].y>t.y&&t.x<(l[m].x-l[d].x)*(t.y-l[d].y)/(l[m].y-l[d].y)+l[d].x&&(r=!r);return r}o(as,"testPolygonPoint");var jt=class Wi{static{o(this,"Line")}p1;p2;constructor(t,r){this.p1=t.clone(),this.p2=r.clone()}transform(t){return new Wi(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Re.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Wi(this.p1,this.p2)}},Re=class _i{static{o(this,"Rect")}pos;width;height;constructor(t,r,l){this.pos=t.clone(),this.width=r,this.height=l}static fromPoints(t,r){return new _i(t.clone(),r.x-t.x,r.y-t.y)}center(){return new S(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new _t(this.points().map(r=>t.multVec2(r)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new _i(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let r=this.pos,l=this.pos.add(this.width,this.height),d=Math.max(r.x-t.x,0,t.x-l.x),m=Math.max(r.y-t.y,0,t.y-l.y);return d*d+m*m}},Vr=class Yr{static{o(this,"Circle")}center;radius;constructor(t,r){this.center=t.clone(),this.radius=r}transform(t){return new jn(this.center,this.radius,this.radius).transform(t)}bbox(){return Re.fromPoints(this.center.sub(B(this.radius)),this.center.add(B(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Yr(this.center,this.radius)}},jn=class $i{static{o(this,"Ellipse")}center;radiusX;radiusY;constructor(t,r,l){this.center=t.clone(),this.radiusX=r,this.radiusY=l}transform(t){return new $i(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return Re.fromPoints(this.center.sub(B(this.radiusX,this.radiusY)),this.center.add(B(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new $i(this.center,this.radiusX,this.radiusY)}},_t=class es{static{o(this,"Polygon")}pts;constructor(t){if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new es(this.pts.map(r=>t.multVec2(r)))}bbox(){let t=B(Number.MAX_VALUE),r=B(-Number.MAX_VALUE);for(let l of this.pts)t.x=Math.min(t.x,l.x),r.x=Math.max(r.x,l.x),t.y=Math.min(t.y,l.y),r.y=Math.max(r.y,l.y);return Re.fromPoints(t,r)}area(){let t=0,r=this.pts.length;for(let l=0;l<r;l++){let d=this.pts[l],m=this.pts[(l+1)%r];t+=d.x*m.y*.5,t-=m.x*d.y*.5}return Math.abs(t)}clone(){return new es(this.pts.map(t=>t.clone()))}};function kr(e,t){let r=Number.MAX_VALUE,l=B(0);for(let d of[e,t])for(let m=0;m<d.pts.length;m++){let E=d.pts[m],I=d.pts[(m+1)%d.pts.length].sub(E).normal().unit(),U=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let y=0;y<e.pts.length;y++){let J=e.pts[y].dot(I);U=Math.min(U,J),A=Math.max(A,J)}let Z=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let y=0;y<t.pts.length;y++){let J=t.pts[y].dot(I);Z=Math.min(Z,J),R=Math.max(R,J)}let z=Math.min(A,R)-Math.max(U,Z);if(z<0)return null;if(z<Math.abs(r)){let y=R-U,J=Z-A;r=Math.abs(y)<Math.abs(J)?y:J,l=I.scale(r)}}return l}o(kr,"sat");var Qr=class extends Map{static{o(this,"Registry")}lastID;constructor(...e){super(...e),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},Nt=class Xr{static{o(this,"EventController")}paused=!1;cancel;constructor(t){this.cancel=t}static join(t){let r=new Xr(()=>t.forEach(l=>l.cancel()));return Object.defineProperty(r,"paused",{get:()=>t[0].paused,set:l=>t.forEach(d=>d.paused=l)}),r.paused=!1,r}},Ge=class{static{o(this,"Event")}handlers=new Qr;add(e){let t=this.handlers.pushd((...l)=>{r.paused||e(...l)}),r=new Nt(t);return r}addOnce(e){let t=this.add((...r)=>{t.cancel(),e(...r)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>t(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},$t=class{static{o(this,"EventHandler")}handlers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new Ge),this.handlers[e].add(t)}onOnce(e,t){let r=this.on(e,(...l)=>{r.cancel(),t(...l)});return r}next(e){return new Promise(t=>{this.onOnce(e,(...r)=>t(r[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function vi(e,t){if(e===t)return!0;let r=typeof e,l=typeof t;if(r!==l)return!1;if(r==="object"&&l==="object"&&e!==null&&t!==null){if(Array.isArray(e)!==Array.isArray(t))return!1;let d=Object.keys(e),m=Object.keys(t);if(d.length!==m.length)return!1;for(let E of d){let I=e[E],U=t[E];if(!vi(I,U))return!1}return!0}return!1}o(vi,"deepEq");function Jr(e){let t=window.atob(e),r=t.length,l=new Uint8Array(r);for(let d=0;d<r;d++)l[d]=t.charCodeAt(d);return l.buffer}o(Jr,"base64ToArrayBuffer");function Zr(e){return Jr(e.split(",")[1])}o(Zr,"dataURLToArrayBuffer");function xi(e,t){let r=document.createElement("a");r.href=t,r.download=e,r.click()}o(xi,"download");function hs(e,t){xi(e,"data:text/plain;charset=utf-8,"+t)}o(hs,"downloadText");function Wr(e,t){hs(e,JSON.stringify(t))}o(Wr,"downloadJSON");function ts(e,t){let r=URL.createObjectURL(t);xi(e,r),URL.revokeObjectURL(r)}o(ts,"downloadBlob");var br=o(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Un=o(e=>e.split(".").slice(0,-1).join("."),"getFileName");function Fe(e,t){return(...r)=>{let l=r.length;if(l===e.length)return e(...r);if(l===t.length)return t(...r)}}o(Fe,"overload2");var Ln=(()=>{let e=0;return()=>e++})(),Gn=o(e=>e instanceof Error?e.message:String(e),"getErrorMessage"),zn=class{static{o(this,"BinaryHeap")}_items;_compareFn;constructor(e=(t,r)=>t<r){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],t=this._items.pop();return this._items.length!==0&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},Hn=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function _r(e){if(typeof e!="string")throw new TypeError("string cannot be undefined or null");let t=[],r=0,l=0;for(;r<e.length;){if(l+=$r(r+l,e),an(e[r+l])&&l++,rn(e[r+l])&&l++,nn(e[r+l])&&l++,hn(e[r+l])){l++;continue}t.push(e.substring(r,r+l)),r+=l,l=0}return t}o(_r,"runes");function $r(e,t){let r=t[e];if(!en(r)||e===t.length-1)return 1;let l=r+t[e+1],d=t.substring(e+2,e+5);return is(l)&&is(d)?4:tn(l)&&on(d)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:sn(d)?4:2}o($r,"nextUnits");function en(e){return e&&mt(e[0].charCodeAt(0),55296,56319)}o(en,"isFirstOfSurrogatePair");function is(e){return mt(Vi(e),127462,127487)}o(is,"isRegionalIndicator");function tn(e){return mt(Vi(e),127988,127988)}o(tn,"isSubdivisionFlag");function sn(e){return mt(Vi(e),127995,127999)}o(sn,"isFitzpatrickModifier");function rn(e){return typeof e=="string"&&mt(e.charCodeAt(0),65024,65039)}o(rn,"isVariationSelector");function nn(e){return typeof e=="string"&&mt(e.charCodeAt(0),8400,8447)}o(nn,"isDiacriticalMark");function on(e){let t=e.codePointAt(0);return typeof e=="string"&&typeof t=="number"&&mt(t,917504,917631)}o(on,"isSupplementarySpecialpurposePlane");function an(e){return typeof e=="string"&&Hn.includes(e.charCodeAt(0))}o(an,"isGrapheme");function hn(e){return typeof e=="string"&&e.charCodeAt(0)===8205}o(hn,"isZeroWidthJoiner");function Vi(e){let t=e.charCodeAt(0)-55296,r=e.charCodeAt(1)-56320;return(t<<10)+r+65536}o(Vi,"codePointFromSurrogatePair");function mt(e,t,r){return e>=t&&e<=r}o(mt,"betweenInclusive");var Sr={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Ai=class{static{o(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Kn=class{static{o(this,"GamepadState")}buttonState=new Ai;stickState=new Map},qn=class{static{o(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,r)=>t+r)/this.dts.length)),this.dts=[])}},Yn=o(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new qn,timeScale:1,skipTime:!1,numFrames:0,mousePos:new S(0),mouseDeltaPos:new S(0),keyState:new Ai,mouseState:new Ai,mergedGamepadState:new Kn,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new $t};function r(){return t.dt*t.timeScale}o(r,"dt");function l(){return t.time}o(l,"time");function d(){return t.fpsCounter.fps}o(d,"fps");function m(){return t.numFrames}o(m,"numFrames");function E(){return t.canvas.toDataURL()}o(E,"screenshot");function I(f){t.canvas.style.cursor=f}o(I,"setCursor");function U(){return t.canvas.style.cursor}o(U,"getCursor");function A(f){if(f)try{let V=t.canvas.requestPointerLock();V.catch&&V.catch(M=>console.error(M))}catch(V){console.error(V)}else document.exitPointerLock()}o(A,"setCursorLocked");function Z(){return!!document.pointerLockElement}o(Z,"isCursorLocked");function R(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}o(R,"enterFullscreen");function z(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(z,"exitFullscreen");function y(){return document.fullscreenElement||document.webkitFullscreenElement}o(y,"getFullscreenElement");function J(f=!0){f?R(t.canvas):z()}o(J,"setFullscreen");function ue(){return!!y()}o(ue,"isFullscreen");function j(){t.stopped=!0;for(let f in ae)t.canvas.removeEventListener(f,ae[f]);for(let f in ge)document.removeEventListener(f,ge[f]);for(let f in ce)window.removeEventListener(f,ce[f]);Ve.disconnect()}o(j,"quit");function D(f){t.loopID!==null&&cancelAnimationFrame(t.loopID);let V=0,M=o(X=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(M);return}let _=X/1e3,we=_-t.realTime,Be=e.maxFPS?1/e.maxFPS:0;t.realTime=_,V+=we,V>Be&&(t.skipTime||(t.dt=V,t.time+=r(),t.fpsCounter.tick(t.dt)),V=0,t.skipTime=!1,t.numFrames++,bt(),f(),zt()),t.loopID=requestAnimationFrame(M)},"frame");M(0)}o(D,"run");function ie(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(ie,"isTouchscreen");function P(){return t.mousePos.clone()}o(P,"mousePos");function x(){return t.mouseDeltaPos.clone()}o(x,"mouseDeltaPos");function L(f="left"){return t.mouseState.pressed.has(f)}o(L,"isMousePressed");function K(f="left"){return t.mouseState.down.has(f)}o(K,"isMouseDown");function q(f="left"){return t.mouseState.released.has(f)}o(q,"isMouseReleased");function de(){return t.isMouseMoved}o(de,"isMouseMoved");function Oe(f){return f===void 0?t.keyState.pressed.size>0:t.keyState.pressed.has(f)}o(Oe,"isKeyPressed");function Me(f){return f===void 0?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(f)}o(Me,"isKeyPressedRepeat");function st(f){return f===void 0?t.keyState.down.size>0:t.keyState.down.has(f)}o(st,"isKeyDown");function le(f){return f===void 0?t.keyState.released.size>0:t.keyState.released.has(f)}o(le,"isKeyReleased");function Ce(f){return f===void 0?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(f)}o(Ce,"isGamepadButtonPressed");function je(f){return f===void 0?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(f)}o(je,"isGamepadButtonDown");function wt(f){return f===void 0?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(f)}o(wt,"isGamepadButtonReleased");function xe(f){return t.events.on("resize",f)}o(xe,"onResize");let Se=Fe(f=>t.events.on("keyDown",f),(f,V)=>t.events.on("keyDown",M=>M===f&&V(f))),ze=Fe(f=>t.events.on("keyPress",f),(f,V)=>t.events.on("keyPress",M=>M===f&&V(f))),rt=Fe(f=>t.events.on("keyPressRepeat",f),(f,V)=>t.events.on("keyPressRepeat",M=>M===f&&V(f))),He=Fe(f=>t.events.on("keyRelease",f),(f,V)=>t.events.on("keyRelease",M=>M===f&&V(f))),nt=Fe(f=>t.events.on("mouseDown",V=>f(V)),(f,V)=>t.events.on("mouseDown",M=>M===f&&V(M))),Ke=Fe(f=>t.events.on("mousePress",V=>f(V)),(f,V)=>t.events.on("mousePress",M=>M===f&&V(M))),At=Fe(f=>t.events.on("mouseRelease",V=>f(V)),(f,V)=>t.events.on("mouseRelease",M=>M===f&&V(M)));function ot(f){return t.events.on("mouseMove",()=>f(P(),x()))}o(ot,"onMouseMove");function Xe(f){return t.events.on("charInput",f)}o(Xe,"onCharInput");function yt(f){return t.events.on("touchStart",f)}o(yt,"onTouchStart");function Je(f){return t.events.on("touchMove",f)}o(Je,"onTouchMove");function at(f){return t.events.on("touchEnd",f)}o(at,"onTouchEnd");function ht(f){return t.events.on("scroll",f)}o(ht,"onScroll");function Ze(f){return t.events.on("hide",f)}o(Ze,"onHide");function lt(f){return t.events.on("show",f)}o(lt,"onShow");function Mt(f,V){if(typeof f=="function")return t.events.on("gamepadButtonDown",f);if(typeof f=="string"&&typeof V=="function")return t.events.on("gamepadButtonDown",M=>M===f&&V(f))}o(Mt,"onGamepadButtonDown");function Bt(f,V){if(typeof f=="function")return t.events.on("gamepadButtonPress",f);if(typeof f=="string"&&typeof V=="function")return t.events.on("gamepadButtonPress",M=>M===f&&V(f))}o(Bt,"onGamepadButtonPress");function Lt(f,V){if(typeof f=="function")return t.events.on("gamepadButtonRelease",f);if(typeof f=="string"&&typeof V=="function")return t.events.on("gamepadButtonRelease",M=>M===f&&V(f))}o(Lt,"onGamepadButtonRelease");function vt(f,V){return t.events.on("gamepadStick",(M,X)=>M===f&&V(X))}o(vt,"onGamepadStick");function Gt(f){t.events.on("gamepadConnect",f)}o(Gt,"onGamepadConnect");function xt(f){t.events.on("gamepadDisconnect",f)}o(xt,"onGamepadDisconnect");function De(f){return t.mergedGamepadState.stickState.get(f)||new S(0)}o(De,"getGamepadStick");function Vt(){return[...t.charInputted]}o(Vt,"charInputted");function Tt(){return[...t.gamepads]}o(Tt,"getGamepads");function bt(){t.events.trigger("input"),t.keyState.down.forEach(f=>t.events.trigger("keyDown",f)),t.mouseState.down.forEach(f=>t.events.trigger("mouseDown",f)),qe()}o(bt,"processInput");function zt(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((f,V)=>{t.mergedGamepadState.stickState.set(V,new S(0))}),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((V,M)=>{f.stickState.set(M,new S(0))})})}o(zt,"resetInput");function It(f){let V={index:f.index,isPressed:M=>t.gamepadStates.get(f.index).buttonState.pressed.has(M),isDown:M=>t.gamepadStates.get(f.index).buttonState.down.has(M),isReleased:M=>t.gamepadStates.get(f.index).buttonState.released.has(M),getStick:M=>t.gamepadStates.get(f.index).stickState.get(M)};return t.gamepads.push(V),t.gamepadStates.set(f.index,{buttonState:new Ai,stickState:new Map([["left",new S(0)],["right",new S(0)]])}),V}o(It,"registerGamepad");function ne(f){t.gamepads=t.gamepads.filter(V=>V.index!==f.index),t.gamepadStates.delete(f.index)}o(ne,"removeGamepad");function qe(){for(let f of navigator.getGamepads())f&&!t.gamepadStates.has(f.index)&&It(f);for(let f of t.gamepads){let V=navigator.getGamepads()[f.index],M=(e.gamepads??{})[V.id]??Sr[V.id]??Sr.default,X=t.gamepadStates.get(f.index);for(let _=0;_<V.buttons.length;_++)V.buttons[_].pressed?(X.buttonState.down.has(M.buttons[_])||(t.mergedGamepadState.buttonState.press(M.buttons[_]),X.buttonState.press(M.buttons[_]),t.events.trigger("gamepadButtonPress",M.buttons[_])),t.events.trigger("gamepadButtonDown",M.buttons[_])):X.buttonState.down.has(M.buttons[_])&&(t.mergedGamepadState.buttonState.release(M.buttons[_]),X.buttonState.release(M.buttons[_]),t.events.trigger("gamepadButtonRelease",M.buttons[_]));for(let _ in M.sticks){let we=M.sticks[_],Be=new S(V.axes[we.x],V.axes[we.y]);X.stickState.set(_,Be),t.mergedGamepadState.stickState.set(_,Be),t.events.trigger("gamepadStick",_,Be)}}}o(qe,"processGamepad");let ae={},ge={},ce={},Ye=e.pixelDensity||window.devicePixelRatio||1;ae.mousemove=f=>{let V=new S(f.offsetX,f.offsetY),M=new S(f.movementX,f.movementY);if(ue()){let X=t.canvas.width/Ye,_=t.canvas.height/Ye,we=window.innerWidth,Be=window.innerHeight,Ht=we/Be,Kt=X/_;if(Ht>Kt){let Ue=Be/_,Te=(we-X*Ue)/2;V.x=gt(f.offsetX-Te,0,X*Ue,0,X),V.y=gt(f.offsetY,0,_*Ue,0,_)}else{let Ue=we/X,Te=(Be-_*Ue)/2;V.x=gt(f.offsetX,0,X*Ue,0,X),V.y=gt(f.offsetY-Te,0,_*Ue,0,_)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=V,t.mouseDeltaPos=M,t.events.trigger("mouseMove")})};let ut=["left","middle","right","back","forward"];ae.mousedown=f=>{t.events.onOnce("input",()=>{let V=ut[f.button];V&&(t.mouseState.press(V),t.events.trigger("mousePress",V))})},ae.mouseup=f=>{t.events.onOnce("input",()=>{let V=ut[f.button];V&&(t.mouseState.release(V),t.events.trigger("mouseRelease",V))})};let ri=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),We={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ae.keydown=f=>{ri.has(f.key)&&f.preventDefault(),t.events.onOnce("input",()=>{let V=We[f.key]||f.key.toLowerCase();V.length===1?(t.events.trigger("charInput",V),t.charInputted.push(V)):V==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),f.repeat?(t.keyState.pressRepeat(V),t.events.trigger("keyPressRepeat",V)):(t.keyState.press(V),t.events.trigger("keyPressRepeat",V),t.events.trigger("keyPress",V))})},ae.keyup=f=>{t.events.onOnce("input",()=>{let V=We[f.key]||f.key.toLowerCase();t.keyState.release(V),t.events.trigger("keyRelease",V)})},ae.touchstart=f=>{f.preventDefault(),t.events.onOnce("input",()=>{let V=[...f.changedTouches],M=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new S(V[0].clientX-M.x,V[0].clientY-M.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),V.forEach(X=>{t.events.trigger("touchStart",new S(X.clientX-M.x,X.clientY-M.y),X)})})},ae.touchmove=f=>{f.preventDefault(),t.events.onOnce("input",()=>{let V=[...f.changedTouches],M=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new S(V[0].clientX-M.x,V[0].clientY-M.y),t.events.trigger("mouseMove")),V.forEach(X=>{t.events.trigger("touchMove",new S(X.clientX-M.x,X.clientY-M.y),X)})})},ae.touchend=f=>{t.events.onOnce("input",()=>{let V=[...f.changedTouches],M=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new S(V[0].clientX-M.x,V[0].clientY-M.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),V.forEach(X=>{t.events.trigger("touchEnd",new S(X.clientX-M.x,X.clientY-M.y),X)})})},ae.touchcancel=f=>{t.events.onOnce("input",()=>{let V=[...f.changedTouches],M=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new S(V[0].clientX-M.x,V[0].clientY-M.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),V.forEach(X=>{t.events.trigger("touchEnd",new S(X.clientX-M.x,X.clientY-M.y),X)})})},ae.wheel=f=>{f.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new S(f.deltaX,f.deltaY))})},ae.contextmenu=f=>f.preventDefault(),ge.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},ce.gamepadconnected=f=>{let V=It(f.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",V)})},ce.gamepaddisconnected=f=>{let V=Tt().filter(M=>M.index===f.gamepad.index)[0];ne(f.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",V)})};for(let f in ae)t.canvas.addEventListener(f,ae[f]);for(let f in ge)document.addEventListener(f,ge[f]);for(let f in ce)window.addEventListener(f,ce[f]);let Ve=new ResizeObserver(f=>{for(let V of f)if(V.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Ve.observe(t.canvas),{dt:r,time:l,run:D,canvas:t.canvas,fps:d,numFrames:m,quit:j,setFullscreen:J,isFullscreen:ue,setCursor:I,screenshot:E,getGamepads:Tt,getCursor:U,setCursorLocked:A,isCursorLocked:Z,isTouchscreen:ie,mousePos:P,mouseDeltaPos:x,isKeyDown:st,isKeyPressed:Oe,isKeyPressedRepeat:Me,isKeyReleased:le,isMouseDown:K,isMousePressed:L,isMouseReleased:q,isMouseMoved:de,isGamepadButtonPressed:Ce,isGamepadButtonDown:je,isGamepadButtonReleased:wt,getGamepadStick:De,charInputted:Vt,onResize:xe,onKeyDown:Se,onKeyPress:ze,onKeyPressRepeat:rt,onKeyRelease:He,onMouseDown:nt,onMousePress:Ke,onMouseRelease:At,onMouseMove:ot,onCharInput:Xe,onTouchStart:yt,onTouchMove:Je,onTouchEnd:at,onScroll:ht,onHide:Ze,onShow:lt,onGamepadButtonDown:Mt,onGamepadButtonPress:Bt,onGamepadButtonRelease:Lt,onGamepadStick:vt,onGamepadConnect:Gt,onGamepadDisconnect:xt,events:t.events}},"default"),Pt=class ln{static{o(this,"Texture")}ctx;src=null;glTex;width;height;constructor(t,r,l,d={}){this.ctx=t;let m=t.gl;this.glTex=t.gl.createTexture(),t.onDestroy(()=>this.free()),this.width=r,this.height=l;let E={linear:m.LINEAR,nearest:m.NEAREST}[d.filter??t.opts.texFilter]??m.NEAREST,I={repeat:m.REPEAT,clampToEadge:m.CLAMP_TO_EDGE}[d.wrap]??m.CLAMP_TO_EDGE;this.bind(),r&&l&&m.texImage2D(m.TEXTURE_2D,0,m.RGBA,r,l,0,m.RGBA,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,E),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,E),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,I),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,I),this.unbind()}static fromImage(t,r,l={}){let d=new ln(t,r.width,r.height,l);return d.update(r),d.src=r,d}update(t,r=0,l=0){let d=this.ctx.gl;this.bind(),d.texSubImage2D(d.TEXTURE_2D,0,r,l,d.RGBA,d.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},ci=class{static{o(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,t,r,l={}){this.ctx=e;let d=e.gl;e.onDestroy(()=>this.free()),this.tex=new Pt(e,t,r,l),this.glFramebuffer=d.createFramebuffer(),this.glRenderbuffer=d.createRenderbuffer(),this.bind(),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,t,r),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.tex.glTex,0),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let r=this.width*4,l=new Uint8Array(r);for(let d=0;d<(this.height/2|0);d++){let m=d*r,E=(this.height-d-1)*r;l.set(t.subarray(m,m+r)),t.copyWithin(m,E,E+r),t.set(l,E)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},kn=class{static{o(this,"Shader")}ctx;glProgram;constructor(e,t,r,l){this.ctx=e,e.onDestroy(()=>this.free());let d=e.gl,m=d.createShader(d.VERTEX_SHADER),E=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(m,t),d.shaderSource(E,r),d.compileShader(m),d.compileShader(E);let I=d.createProgram();if(this.glProgram=I,d.attachShader(I,m),d.attachShader(I,E),l.forEach((U,A)=>d.bindAttribLocation(I,A,U)),d.linkProgram(I),!d.getProgramParameter(I,d.LINK_STATUS)){let U=d.getShaderInfoLog(m);if(U)throw new Error("VERTEX SHADER "+U);let A=d.getShaderInfoLog(E);if(A)throw new Error("FRAGMENT SHADER "+A)}d.deleteShader(m),d.deleteShader(E)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let r in e){let l=e[r],d=t.getUniformLocation(this.glProgram,r);typeof l=="number"?t.uniform1f(d,l):l instanceof ke?t.uniformMatrix4fv(d,!1,new Float32Array(l.m)):l instanceof oe?t.uniform3f(d,l.r,l.g,l.b):l instanceof S&&t.uniform2f(d,l.x,l.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},Qn=class{static{o(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,t,r,l){let d=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((m,E)=>m+E.size,0),this.maxVertices=r,this.maxIndices=l,this.glVBuf=d.createBuffer(),e.pushArrayBuffer(this.glVBuf),d.bufferData(d.ARRAY_BUFFER,r*4,d.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=d.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),d.bufferData(d.ELEMENT_ARRAY_BUFFER,l*4,d.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,r,l,d=null,m={}){(e!==this.curPrimitive||d!==this.curTex||l!==this.curShader||!vi(this.curUniform,m)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let E=this.vqueue.length/this.stride;for(let I of t)this.vqueue.push(I);for(let I of r)this.iqueue.push(I+E);this.curPrimitive=e,this.curShader=l,this.curTex=d,this.curUniform=m}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function pt(e){let t=[],r=o(m=>{t.push(m),e(m)},"push"),l=o(()=>{t.pop(),e(d()??null)},"pop"),d=o(()=>t[t.length-1],"cur");return[r,l,d]}o(pt,"genStack");function un(e,t={}){let r=[];function l(L){r.push(L)}o(l,"onDestroy");function d(){r.forEach(L=>L()),e.getExtension("WEBGL_lose_context").loseContext()}o(d,"destroy");let m=null;function E(L){if(vi(L,m))return;m=L;let K=L.reduce((q,de)=>q+de.size,0);L.reduce((q,de,Oe)=>(e.vertexAttribPointer(Oe,de.size,e.FLOAT,!1,K*4,q),e.enableVertexAttribArray(Oe),q+de.size*4),0)}o(E,"setVertexFormat");let[I,U]=pt(L=>e.bindTexture(e.TEXTURE_2D,L)),[A,Z]=pt(L=>e.bindBuffer(e.ARRAY_BUFFER,L)),[R,z]=pt(L=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,L)),[y,J]=pt(L=>e.bindFramebuffer(e.FRAMEBUFFER,L)),[ue,j]=pt(L=>e.bindRenderbuffer(e.RENDERBUFFER,L)),[D,ie]=pt(({x:L,y:K,w:q,h:de})=>{e.viewport(L,K,q,de)}),[P,x]=pt(L=>e.useProgram(L));return D({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:l,destroy:d,pushTexture2D:I,popTexture2D:U,pushArrayBuffer:A,popArrayBuffer:Z,pushElementArrayBuffer:R,popElementArrayBuffer:z,pushFramebuffer:y,popFramebuffer:J,pushRenderbuffer:ue,popRenderbuffer:j,pushViewport:D,popViewport:ie,pushProgram:P,popProgram:x,setVertexFormat:E}}o(un,"initGfx");var Ne=class cn{static{o(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new Ge;onErrorEvents=new Ge;onFinishEvents=new Ge;constructor(t){t.then(r=>{this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let r=new cn(Promise.resolve(t));return r.data=t,r.loaded=!0,r}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},Dt=class{static{o(this,"AssetBucket")}assets=new Map;lastUID=0;add(e,t){let r=e??this.lastUID+++"",l=new Ne(t);return this.assets.set(r,l),l}addLoaded(e,t){let r=e??this.lastUID+++"",l=Ne.loaded(t);return this.assets.set(r,l),l}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}};function bi(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}o(bi,"fetchURL");function ei(e){return bi(e).then(t=>t.json())}o(ei,"fetchJSON");function dn(e){return bi(e).then(t=>t.text())}o(dn,"fetchText");function fn(e){return bi(e).then(t=>t.arrayBuffer())}o(fn,"fetchArrayBuffer");function ti(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((r,l)=>{t.onload=()=>r(t),t.onerror=()=>l(new Error(`Failed to load image from "${e}"`))})}o(ti,"loadImg");var di=2.5949095,Er=1.70158+1,Rr=2*Math.PI/3,Pr=2*Math.PI/4.5,yi={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Er*e*e*e-1.70158*e*e,easeOutBack:e=>1+Er*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((di+1)*2*e-di)/2:(Math.pow(2*e-2,2)*((di+1)*(e*2-2)+di)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*Rr),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*Rr)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Pr))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Pr)/2+1,easeInBounce:e=>1-yi.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-yi.easeOutBounce(1-2*e))/2:(1+yi.easeOutBounce(2*e-1))/2},fi=yi,Xn=class{static{o(this,"TexPacker")}textures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,t,r){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=r,this.textures=[Pt.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Pt.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],r=new S(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,r.x,r.y):this.c2d.drawImage(e,r.x,r.y),t.update(this.canvas),[t,new ve(r.x/this.canvas.width,r.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},Jn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Zn=Cn("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Wn="data:image/png;base64,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",_n="data:image/png;base64,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",$n="3000.1.17",Mr=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",pi="topleft",Br=64,eo="monospace",gi="monospace",to=36,mi=64,wi=256,Tr=2048,Ir=2048,Fr=2048,Cr=2048,Dr=.1,io=64,Yi="linear",so=8,ro=4,ss=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],no=ss.reduce((e,t)=>e+t.size,0),pn=2048,oo=pn*4*no,ao=pn*6,ho=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,lo=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,ki=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Qi=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,uo=new Set(["id","require"]),co=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Rt(e){switch(e){case"topleft":return new S(-1,-1);case"top":return new S(0,-1);case"topright":return new S(1,-1);case"left":return new S(-1,0);case"center":return new S(0,0);case"right":return new S(1,0);case"botleft":return new S(-1,1);case"bot":return new S(0,1);case"botright":return new S(1,1);default:return e}}o(Rt,"anchorPt");function gn(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(gn,"alignPt");function mn(e){return e.createBuffer(1,1,44100)}o(mn,"createEmptyAudioBuffer");var wn=o((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=e.canvas??(()=>{let i=document.createElement("canvas");return t.appendChild(i),i})(),l=e.scale??1,d=e.width&&e.height&&!e.stretch&&!e.letterbox;d?(r.width=e.width*l,r.height=e.height*l):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let m=["outline: none","cursor: default"];if(d){let i=r.width,s=r.height;m.push(`width: ${i}px`),m.push(`height: ${s}px`)}else m.push("width: 100%"),m.push("height: 100%");e.crisp&&(m.push("image-rendering: pixelated"),m.push("image-rendering: crisp-edges")),r.style.cssText=m.join(";");let E=e.pixelDensity||window.devicePixelRatio;r.width*=E,r.height*=E,r.tabIndex=0;let I=document.createElement("canvas");I.width=wi,I.height=wi;let U=I.getContext("2d",{willReadFrequently:!0}),A=Yn({canvas:r,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),Z=[],R=A.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),z=un(R,{texFilter:e.texFilter}),y=(()=>{let i=vt(ki,Qi),s=Pt.fromImage(z,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),n=e.width&&e.height?new ci(z,e.width*E*l,e.height*E*l):new ci(z,R.drawingBufferWidth,R.drawingBufferHeight),h=null,a=1;e.background&&(h=se(e.background),a=Array.isArray(e.background)?e.background[3]:1,R.clearColor(h.r/255,h.g/255,h.b/255,a??1)),R.enable(R.BLEND),R.blendFuncSeparate(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA);let u=new Qn(z,ss,oo,ao),p=Pt.fromImage(z,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:i,defTex:s,frameBuffer:n,postShader:null,postShaderUniform:null,renderer:u,transform:new ke,transformStack:[],bgTex:p,bgColor:h,bgAlpha:a,width:e.width??R.drawingBufferWidth/E/l,height:e.height??R.drawingBufferHeight/E/l,viewport:{x:0,y:0,width:R.drawingBufferWidth,height:R.drawingBufferHeight},fixed:!1}})();class J{static{o(this,"SpriteData")}tex;frames=[new ve(0,0,1,1)];anims={};slice9=null;constructor(s,n,h={},a=null){this.tex=s,n&&(this.frames=n),this.anims=h,this.slice9=a}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(s,n={}){return typeof s=="string"?J.fromURL(s,n):Promise.resolve(J.fromImage(s,n))}static fromImage(s,n={}){let[h,a]=D.packer.add(s),u=n.frames?n.frames.map(p=>new ve(a.x+p.x*a.w,a.y+p.y*a.h,p.w*a.w,p.h*a.h)):st(n.sliceX||1,n.sliceY||1,a.x,a.y,a.w,a.h);return new J(h,u,n.anims,n.slice9)}static fromURL(s,n={}){return ti(s).then(h=>J.fromImage(h,n))}}class ue{static{o(this,"SoundData")}buf;constructor(s){this.buf=s}static fromArrayBuffer(s){return new Promise((n,h)=>j.ctx.decodeAudioData(s,n,h)).then(n=>new ue(n))}static fromURL(s){return br(s)?ue.fromArrayBuffer(Zr(s)):fn(s).then(n=>ue.fromArrayBuffer(n))}}let j=(()=>{let i=new(window.AudioContext||window.webkitAudioContext),s=i.createGain();s.connect(i.destination);let n=new ue(mn(i));return i.decodeAudioData(Zn.buffer.slice(0)).then(h=>{n.buf=h}).catch(h=>{console.error("Failed to load burp: ",h)}),{ctx:i,masterNode:s,burpSnd:n}})(),D={urlPrefix:"",sprites:new Dt,fonts:new Dt,bitmapFonts:new Dt,sounds:new Dt,shaders:new Dt,custom:new Dt,packer:new Xn(z,Fr,Cr),loaded:!1};function ie(i){return typeof i!="string"||br(i)?i:D.urlPrefix+i}o(ie,"fixURL");let P={events:new $t,objEvents:new $t,root:ni([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new S(1),angle:0,shake:0,transform:new ke}};P.root.use(hi());function x(i){return D.custom.add(null,i)}o(x,"load");function L(){let i=[D.sprites,D.sounds,D.shaders,D.fonts,D.bitmapFonts,D.custom];return i.reduce((s,n)=>s+n.progress(),0)/i.length}o(L,"loadProgress");function K(i){return i!==void 0&&(D.urlPrefix=i),D.urlPrefix}o(K,"loadRoot");function q(i,s){return D.custom.add(i,ei(s))}o(q,"loadJSON");class de{static{o(this,"FontData")}fontface;filter=Yi;outline=null;size=mi;constructor(s,n={}){if(this.fontface=s,this.filter=n.filter??Yi,this.size=n.size??mi,this.size>wi)throw new Error(`Max font size: ${wi}`);n.outline&&(this.outline={width:1,color:se(0,0,0)},typeof n.outline=="number"?this.outline.width=n.outline:typeof n.outline=="object"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}}function Oe(i,s,n={}){let h=new FontFace(i,typeof s=="string"?`url(${s})`:s);return document.fonts.add(h),D.fonts.add(i,h.load().catch(a=>{throw new Error(`Failed to load font from "${s}": ${a}`)}).then(a=>new de(a,n)))}o(Oe,"loadFont");function Me(i,s,n,h,a={}){return D.bitmapFonts.add(i,ti(s).then(u=>Gt(Pt.fromImage(z,u,a),n,h,a.chars??Mr)))}o(Me,"loadBitmapFont");function st(i=1,s=1,n=0,h=0,a=1,u=1){let p=[],v=a/i,g=u/s;for(let c=0;c<s;c++)for(let w=0;w<i;w++)p.push(new ve(n+w*v,h+c*g,v,g));return p}o(st,"slice");function le(i,s){return i=ie(i),x(typeof s=="string"?new Promise((n,h)=>{ei(s).then(a=>{le(i,a).then(n).catch(h)})}):J.from(i).then(n=>{let h={};for(let a in s){let u=s[a],p=n.frames[0],v=Fr*p.w,g=Cr*p.h,c=u.frames?u.frames.map(T=>new ve(p.x+(u.x+T.x)/v*p.w,p.y+(u.y+T.y)/g*p.h,T.w/v*p.w,T.h/g*p.h)):st(u.sliceX||1,u.sliceY||1,p.x+u.x/v*p.w,p.y+u.y/g*p.h,u.width/v*p.w,u.height/g*p.h),w=new J(n.tex,c,u.anims);D.sprites.addLoaded(a,w),h[a]=w}return h}))}o(le,"loadSpriteAtlas");function Ce(i,s={}){let n=document.createElement("canvas"),h=i[0].width,a=i[0].height;n.width=h*i.length,n.height=a;let u=n.getContext("2d");i.forEach((v,g)=>{v instanceof ImageData?u.putImageData(v,g*h,0):u.drawImage(v,g*h,0)});let p=u.getImageData(0,0,i.length*h,a);return J.fromImage(p,{...s,sliceX:i.length,sliceY:1})}o(Ce,"createSpriteSheet");function je(i,s,n={sliceX:1,sliceY:1,anims:{}}){return s=ie(s),Array.isArray(s)?s.some(h=>typeof h=="string")?D.sprites.add(i,Promise.all(s.map(h=>typeof h=="string"?ti(h):Promise.resolve(h))).then(h=>Ce(h,n))):D.sprites.addLoaded(i,Ce(s,n)):typeof s=="string"?D.sprites.add(i,J.from(s,n)):D.sprites.addLoaded(i,J.fromImage(s,n))}o(je,"loadSprite");function wt(i,s){return s=ie(s),D.sprites.add(i,new Promise(async n=>{let h=typeof s=="string"?await ei(s):s,a=await Promise.all(h.frames.map(ti)),u=document.createElement("canvas");u.width=h.width,u.height=h.height*h.frames.length;let p=u.getContext("2d");a.forEach((g,c)=>{p.drawImage(g,0,c*h.height)});let v=await je(null,u,{sliceY:h.frames.length,anims:h.anims});n(v)}))}o(wt,"loadPedit");function xe(i,s,n){s=ie(s),n=ie(n),typeof s=="string"&&!n&&(n=Un(s)+".json");let h=typeof n=="string"?ei(n):Promise.resolve(n);return D.sprites.add(i,h.then(a=>{let u=a.meta.size,p=a.frames.map(g=>new ve(g.frame.x/u.w,g.frame.y/u.h,g.frame.w/u.w,g.frame.h/u.h)),v={};for(let g of a.meta.frameTags)g.from===g.to?v[g.name]=g.from:v[g.name]={from:g.from,to:g.to,speed:10,loop:!0,pingpong:g.direction==="pingpong"};return J.from(s,{frames:p,anims:v})}))}o(xe,"loadAseprite");function Se(i,s,n){return D.shaders.addLoaded(i,vt(s,n))}o(Se,"loadShader");function ze(i,s,n){s=ie(s),n=ie(n);let h=o(u=>u?dn(u):Promise.resolve(null),"resolveUrl"),a=Promise.all([h(s),h(n)]).then(([u,p])=>vt(u,p));return D.shaders.add(i,a)}o(ze,"loadShaderURL");function rt(i,s){return s=ie(s),D.sounds.add(i,typeof s=="string"?ue.fromURL(s):ue.fromArrayBuffer(s))}o(rt,"loadSound");function He(i="bean"){return je(i,Jn)}o(He,"loadBean");function nt(i){return D.sprites.get(i)}o(nt,"getSprite");function Ke(i){return D.sounds.get(i)}o(Ke,"getSound");function At(i){return D.fonts.get(i)}o(At,"getFont");function ot(i){return D.bitmapFonts.get(i)}o(ot,"getBitmapFont");function Xe(i){return D.shaders.get(i)}o(Xe,"getShader");function yt(i){return D.custom.get(i)}o(yt,"getAsset");function Je(i){if(typeof i=="string"){let s=nt(i);if(s)return s;if(L()<1)return null;throw new Error(`Sprite not found: ${i}`)}else{if(i instanceof J)return Ne.loaded(i);if(i instanceof Ne)return i;throw new Error(`Invalid sprite: ${i}`)}}o(Je,"resolveSprite");function at(i){if(typeof i=="string"){let s=Ke(i);if(s)return s;if(L()<1)return null;throw new Error(`Sound not found: ${i}`)}else{if(i instanceof ue)return Ne.loaded(i);if(i instanceof Ne)return i;throw new Error(`Invalid sound: ${i}`)}}o(at,"resolveSound");function ht(i){if(!i)return y.defShader;if(typeof i=="string"){let s=Xe(i);if(s)return s.data??s;if(L()<1)return null;throw new Error(`Shader not found: ${i}`)}else if(i instanceof Ne)return i.data?i.data:i;return i}o(ht,"resolveShader");function Ze(i){if(!i)return Ze(e.font??eo);if(typeof i=="string"){let s=ot(i),n=At(i);if(s)return s.data??s;if(n)return n.data??n;if(document.fonts.check(`${mi}px ${i}`))return i;if(L()<1)return null;throw new Error(`Font not found: ${i}`)}else if(i instanceof Ne)return i.data?i.data:i;return i}o(Ze,"resolveFont");function lt(i){return i!==void 0&&(j.masterNode.gain.value=i),j.masterNode.gain.value}o(lt,"volume");function Mt(i,s={}){let n=j.ctx,h=s.paused??!1,a=n.createBufferSource(),u=new Ge,p=n.createGain(),v=s.seek??0,g=0,c=0,w=!1;a.loop=!!s.loop,a.detune.value=s.detune??0,a.playbackRate.value=s.speed??1,a.connect(p),a.onended=()=>{Y()>=a.buffer?.duration&&u.trigger()},p.connect(j.masterNode),p.gain.value=s.volume??1;let T=o(O=>{a.buffer=O.buf,h||(g=n.currentTime,a.start(0,v),w=!0)},"start"),F=at(i);F instanceof Ne&&F.onLoad(T);let Y=o(()=>{if(!a.buffer)return 0;let O=h?c-g:n.currentTime-g,H=a.buffer.duration;return a.loop?O%H:Math.min(O,H)},"getTime"),k=o(O=>{let H=n.createBufferSource();return H.buffer=O.buffer,H.loop=O.loop,H.playbackRate.value=O.playbackRate.value,H.detune.value=O.detune.value,H.onended=O.onended,H.connect(p),H},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(O){if(h!==O)if(h=O,O)w&&(a.stop(),w=!1),c=n.currentTime;else{a=k(a);let H=c-g;a.start(0,H),w=!0,g=n.currentTime-H,c=0}},get paused(){return h},play(O=0){this.seek(O),this.paused=!1},seek(O){a.buffer?.duration&&(O>a.buffer.duration||(h?(a=k(a),g=c-O):(a.stop(),a=k(a),g=n.currentTime-O,a.start(0,O),w=!0,c=0)))},set speed(O){a.playbackRate.value=O},get speed(){return a.playbackRate.value},set detune(O){a.detune.value=O},get detune(){return a.detune.value},set volume(O){p.gain.value=Math.max(O,0)},get volume(){return p.gain.value},set loop(O){a.loop=O},get loop(){return a.loop},duration(){return a.buffer?.duration??0},time(){return Y()%this.duration()},onEnd(O){return u.add(O)},then(O){return this.onEnd(O)}}}o(Mt,"play");function Bt(i){return Mt(j.burpSnd,i)}o(Bt,"burp");function Lt(i,s){return new ci(z,i,s)}o(Lt,"makeCanvas");function vt(i=ki,s=Qi){let n=ho.replace("{{user}}",i??ki),h=lo.replace("{{user}}",s??Qi);try{return new kn(z,n,h,ss.map(a=>a.name))}catch(a){let u=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,p=Gn(a).match(u),v=Number(p.groups.line)-14,g=p.groups.msg.trim(),c=p.groups.type.toLowerCase();throw new Error(`${c} shader line ${v}: ${g}`)}}o(vt,"makeShader");function Gt(i,s,n,h){let a=i.width/s,u={},p=h.split("").entries();for(let[v,g]of p)u[g]=new ve(v%a*s,Math.floor(v/a)*n,s,n);return{tex:i,map:u,size:n}}o(Gt,"makeFont");function xt(i,s,n,h=y.defTex,a=y.defShader,u={}){let p=ht(a);if(!p||p instanceof Ne)return;let v=y.fixed||n?y.transform:P.cam.transform.mult(y.transform),g=[];for(let c of i){let w=zt(v.multVec2(c.pos));g.push(w.x,w.y,c.uv.x,c.uv.y,c.color.r/255,c.color.g/255,c.color.b/255,c.opacity)}y.renderer.push(R.TRIANGLES,g,s,p,h,u)}o(xt,"drawRaw");function De(){y.renderer.flush()}o(De,"flush");function Vt(){R.clear(R.COLOR_BUFFER_BIT),y.frameBuffer.bind(),R.clear(R.COLOR_BUFFER_BIT),y.bgColor||Te(()=>{Ye({width:be(),height:Ee(),quad:new ve(0,0,be()/Br,Ee()/Br),tex:y.bgTex,fixed:!0})}),y.renderer.numDraws=0,y.fixed=!1,y.transformStack.length=0,y.transform=new ke}o(Vt,"frameStart");function Tt(i,s){y.postShader=i,y.postShaderUniform=s??null}o(Tt,"usePostEffect");function bt(){De(),y.lastDrawCalls=y.renderer.numDraws,y.frameBuffer.unbind(),R.viewport(0,0,R.drawingBufferWidth,R.drawingBufferHeight);let i=y.width,s=y.height;y.width=R.drawingBufferWidth/E,y.height=R.drawingBufferHeight/E,ut({flipY:!0,tex:y.frameBuffer.tex,pos:new S(y.viewport.x,y.viewport.y),width:y.viewport.width,height:y.viewport.height,shader:y.postShader,uniform:typeof y.postShaderUniform=="function"?y.postShaderUniform():y.postShaderUniform,fixed:!0}),De(),y.width=i,y.height=s}o(bt,"frameEnd");function zt(i){return new S(i.x/be()*2-1,-i.y/Ee()*2+1)}o(zt,"screen2ndc");function It(i){y.transform=i.clone()}o(It,"pushMatrix");function ne(...i){if(i[0]===void 0)return;let s=B(...i);s.x===0&&s.y===0||y.transform.translate(s)}o(ne,"pushTranslate");function qe(...i){if(i[0]===void 0)return;let s=B(...i);s.x===1&&s.y===1||y.transform.scale(s)}o(qe,"pushScale");function ae(i){i&&y.transform.rotate(i)}o(ae,"pushRotate");function ge(){y.transformStack.push(y.transform.clone())}o(ge,"pushTransform");function ce(){y.transformStack.length>0&&(y.transform=y.transformStack.pop())}o(ce,"popTransform");function Ye(i){if(i.width===void 0||i.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let s=i.width,n=i.height,h=Rt(i.anchor||pi).scale(new S(s,n).scale(-.5)),a=i.quad||new ve(0,0,1,1),u=i.color||se(255,255,255),p=i.opacity??1,v=i.tex?Dr/i.tex.width:0,g=i.tex?Dr/i.tex.height:0,c=a.x+v,w=a.y+g,T=a.w-v*2,F=a.h-g*2;ge(),ne(i.pos),ae(i.angle),qe(i.scale),ne(h),xt([{pos:new S(-s/2,n/2),uv:new S(i.flipX?c+T:c,i.flipY?w:w+F),color:u,opacity:p},{pos:new S(-s/2,-n/2),uv:new S(i.flipX?c+T:c,i.flipY?w+F:w),color:u,opacity:p},{pos:new S(s/2,-n/2),uv:new S(i.flipX?c:c+T,i.flipY?w+F:w),color:u,opacity:p},{pos:new S(s/2,n/2),uv:new S(i.flipX?c:c+T,i.flipY?w:w+F),color:u,opacity:p}],[0,1,3,1,2,3],i.fixed,i.tex,i.shader,i.uniform),ce()}o(Ye,"drawUVQuad");function ut(i){if(!i.tex)throw new Error('drawTexture() requires property "tex".');let s=i.quad??new ve(0,0,1,1),n=i.tex.width*s.w,h=i.tex.height*s.h,a=new S(1);if(i.tiled){let u=Math.ceil((i.width||n)/n),p=Math.ceil((i.height||h)/h),v=Rt(i.anchor||pi).add(new S(1,1)).scale(.5).scale(u*n,p*h);for(let g=0;g<u;g++)for(let c=0;c<p;c++)Ye(Object.assign({},i,{pos:(i.pos||new S(0)).add(new S(n*g,h*c)).sub(v),scale:a.scale(i.scale||new S(1)),tex:i.tex,quad:s,width:n,height:h,anchor:"topleft"}))}else i.width&&i.height?(a.x=i.width/n,a.y=i.height/h):i.width?(a.x=i.width/n,a.y=a.x):i.height&&(a.y=i.height/h,a.x=a.y),Ye(Object.assign({},i,{scale:a.scale(i.scale||new S(1)),tex:i.tex,quad:s,width:n,height:h}))}o(ut,"drawTexture");function ri(i){if(!i.sprite)throw new Error('drawSprite() requires property "sprite"');let s=Je(i.sprite);if(!s||!s.data)return;let n=s.data.frames[i.frame??0];if(!n)throw new Error(`Frame not found: ${i.frame??0}`);ut(Object.assign({},i,{tex:s.data.tex,quad:n.scale(i.quad??new ve(0,0,1,1))}))}o(ri,"drawSprite");function We(i,s,n,h,a,u=1){h=Qe(h%360),a=Qe(a%360),a<=h&&(a+=Math.PI*2);let p=[],v=Math.ceil((a-h)/Qe(8)*u),g=(a-h)/v;for(let c=h;c<a;c+=g)p.push(i.add(s*Math.cos(c),n*Math.sin(c)));return p.push(i.add(s*Math.cos(a),n*Math.sin(a))),p}o(We,"getArcPts");function Ve(i){if(i.width===void 0||i.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let s=i.width,n=i.height,h=Rt(i.anchor||pi).add(1,1).scale(new S(s,n).scale(-.5)),a=[new S(0,0),new S(s,0),new S(s,n),new S(0,n)];if(i.radius){let u=Math.min(Math.min(s,n)/2,i.radius);a=[new S(u,0),new S(s-u,0),...We(new S(s-u,u),u,u,270,360),new S(s,u),new S(s,n-u),...We(new S(s-u,n-u),u,u,0,90),new S(s-u,n),new S(u,n),...We(new S(u,n-u),u,u,90,180),new S(0,n-u),new S(0,u),...We(new S(u,u),u,u,180,270)]}we(Object.assign({},i,{offset:h,pts:a,...i.gradient?{colors:i.horizontal?[i.gradient[0],i.gradient[1],i.gradient[1],i.gradient[0]]:[i.gradient[0],i.gradient[0],i.gradient[1],i.gradient[1]]}:{}}))}o(Ve,"drawRect");function f(i){let{p1:s,p2:n}=i;if(!s||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let h=i.width||1,a=n.sub(s).unit().normal().scale(h*.5),u=[s.sub(a),s.add(a),n.add(a),n.sub(a)].map(p=>({pos:new S(p.x,p.y),uv:new S(0),color:i.color??oe.WHITE,opacity:i.opacity??1}));xt(u,[0,1,3,1,2,3],i.fixed,y.defTex,i.shader,i.uniform)}o(f,"drawLine");function V(i){let s=i.pts;if(!s)throw new Error('drawLines() requires property "pts".');if(!(s.length<2))if(i.radius&&s.length>=3){let n=s[0].sdist(s[1]);for(let a=1;a<s.length-1;a++)n=Math.min(s[a].sdist(s[a+1]),n);let h=Math.min(i.radius,Math.sqrt(n)/2);f(Object.assign({},i,{p1:s[0],p2:s[1]}));for(let a=1;a<s.length-2;a++){let u=s[a],p=s[a+1];f(Object.assign({},i,{p1:u,p2:p}))}f(Object.assign({},i,{p1:s[s.length-2],p2:s[s.length-1]}))}else for(let n=0;n<s.length-1;n++)f(Object.assign({},i,{p1:s[n],p2:s[n+1]})),i.join!=="none"&&X(Object.assign({},i,{pos:s[n],radius:i.width/2}))}o(V,"drawLines");function M(i){if(!i.p1||!i.p2||!i.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return we(Object.assign({},i,{pts:[i.p1,i.p2,i.p3]}))}o(M,"drawTriangle");function X(i){if(typeof i.radius!="number")throw new Error('drawCircle() requires property "radius".');i.radius!==0&&_(Object.assign({},i,{radiusX:i.radius,radiusY:i.radius,angle:0}))}o(X,"drawCircle");function _(i){if(i.radiusX===void 0||i.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(i.radiusX===0||i.radiusY===0)return;let s=i.start??0,n=i.end??360,h=Rt(i.anchor??"center").scale(new S(-i.radiusX,-i.radiusY)),a=We(h,i.radiusX,i.radiusY,s,n,i.resolution);a.unshift(h);let u=Object.assign({},i,{pts:a,radius:0,...i.gradient?{colors:[i.gradient[0],...Array(a.length-1).fill(i.gradient[1])]}:{}});if(n-s>=360&&i.outline){i.fill!==!1&&we(Object.assign(u,{outline:null})),we(Object.assign(u,{pts:a.slice(1),fill:!1}));return}we(u)}o(_,"drawEllipse");function we(i){if(!i.pts)throw new Error('drawPolygon() requires property "pts".');let s=i.pts.length;if(!(s<3)){if(ge(),ne(i.pos),qe(i.scale),ae(i.angle),ne(i.offset),i.fill!==!1){let n=i.color??oe.WHITE,h=i.pts.map((u,p)=>({pos:new S(u.x,u.y),uv:new S(0,0),color:i.colors&&i.colors[p]?i.colors[p].mult(n):n,opacity:i.opacity??1})),a=[...Array(s-2).keys()].map(u=>[0,u+1,u+2]).flat();xt(h,i.indices??a,i.fixed,y.defTex,i.shader,i.uniform)}i.outline&&V({pts:[...i.pts,i.pts[0]],radius:i.radius,width:i.outline.width,color:i.outline.color,join:i.outline.join,uniform:i.uniform,fixed:i.fixed,opacity:i.opacity}),ce()}}o(we,"drawPolygon");function Be(i,s,n){De(),R.clear(R.STENCIL_BUFFER_BIT),R.enable(R.STENCIL_TEST),R.stencilFunc(R.NEVER,1,255),R.stencilOp(R.REPLACE,R.REPLACE,R.REPLACE),s(),De(),R.stencilFunc(n,1,255),R.stencilOp(R.KEEP,R.KEEP,R.KEEP),i(),De(),R.disable(R.STENCIL_TEST)}o(Be,"drawStenciled");function Ht(i,s){Be(i,s,R.EQUAL)}o(Ht,"drawMasked");function Kt(i,s){Be(i,s,R.NOTEQUAL)}o(Kt,"drawSubtracted");function Ue(){return(y.viewport.width+y.viewport.height)/(y.width+y.height)}o(Ue,"getViewportScale");function Te(i){De();let s=y.width,n=y.height;y.width=y.viewport.width,y.height=y.viewport.height,i(),De(),y.width=s,y.height=n}o(Te,"drawUnscaled");function Si(i,s){s.pos&&(i.pos=i.pos.add(s.pos)),s.scale&&(i.scale=i.scale.scale(B(s.scale))),s.angle&&(i.angle+=s.angle),s.color&&i.ch.length===1&&(i.color=i.color.mult(s.color)),s.opacity&&(i.opacity*=s.opacity)}o(Si,"applyCharTransform");let us=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function cs(i){let s={},n=i.replace(us,"$2"),h=0;for(let a of i.matchAll(us)){let u=a.index-h;for(let p=0;p<a.groups.text.length;p++)s[p+u]=[a.groups.style];h+=a[0].length-a.groups.text.length}return{charStyleMap:s,text:n}}o(cs,"compileStyledText");let Ei={};function ct(i){if(i.text===void 0)throw new Error('formatText() requires property "text".');let s=Ze(i.font);if(i.text===""||s instanceof Ne||!s)return{width:0,height:0,chars:[],opt:i};let{charStyleMap:n,text:h}=cs(i.text+""),a=_r(h);if(s instanceof de||typeof s=="string"){let $=s instanceof de?s.fontface.family:s,ee=s instanceof de?{outline:s.outline,filter:s.filter}:{outline:null,filter:Yi},Q=Ei[$]??{font:{tex:new Pt(z,Tr,Ir,{filter:ee.filter}),map:{},size:mi},cursor:new S(0),outline:ee.outline};Ei[$]||(Ei[$]=Q),s=Q.font;for(let Ae of a)if(!Q.font.map[Ae]){let b=U;b.clearRect(0,0,I.width,I.height),b.font=`${s.size}px ${$}`,b.textBaseline="top",b.textAlign="left",b.fillStyle="#ffffff";let C=b.measureText(Ae),N=Math.ceil(C.width),G=s.size;Q.outline&&(b.lineJoin="round",b.lineWidth=Q.outline.width*2,b.strokeStyle=Q.outline.color.toHex(),b.strokeText(Ae,Q.outline.width,Q.outline.width),N+=Q.outline.width*2,G+=Q.outline.width*3),b.fillText(Ae,Q.outline?.width??0,Q.outline?.width??0);let te=b.getImageData(0,0,N,G);if(Q.cursor.x+N>Tr&&(Q.cursor.x=0,Q.cursor.y+=G,Q.cursor.y>Ir))throw new Error("Font atlas exceeds character limit");s.tex.update(te,Q.cursor.x,Q.cursor.y),s.map[Ae]=new ve(Q.cursor.x,Q.cursor.y,N,G),Q.cursor.x+=N}}let u=i.size||s.size,p=B(i.scale??1).scale(u/s.size),v=i.lineSpacing??0,g=i.letterSpacing??0,c=0,w=0,T=0,F=[],Y=[],k=0,O=null,H=null;for(;k<a.length;){let $=a[k];if($===`
`)T+=u+v,F.push({width:c-g,chars:Y}),O=null,H=null,c=0,Y=[];else{let ee=s.map[$];if(ee){let Q=ee.w*p.x;i.width&&c+Q>i.width&&(T+=u+v,O!=null&&(k-=Y.length-O,$=a[k],ee=s.map[$],Q=ee.w*p.x,Y=Y.slice(0,O-1),c=H),O=null,H=null,F.push({width:c-g,chars:Y}),c=0,Y=[]),Y.push({tex:s.tex,width:ee.w,height:ee.h,quad:new ve(ee.x/s.tex.width,ee.y/s.tex.height,ee.w/s.tex.width,ee.h/s.tex.height),ch:$,pos:new S(c,T),opacity:i.opacity??1,color:i.color??oe.WHITE,scale:B(p),angle:0}),$===" "&&(O=Y.length,H=c),c+=Q,w=Math.max(w,c),c+=g}}k++}F.push({width:c-g,chars:Y}),T+=u,i.width&&(w=i.width);let Ie=[];for(let $ of F){let ee=(w-$.width)*gn(i.align??"left");for(let Q of $.chars){let Ae=s.map[Q.ch],b=Ie.length;if(Q.pos=Q.pos.add(ee,0).add(Ae.w*p.x*.5,Ae.h*p.y*.5),i.transform){let C=typeof i.transform=="function"?i.transform(b,Q.ch):i.transform;C&&Si(Q,C)}if(n[b]){let C=n[b];for(let N of C){let G=i.styles[N],te=typeof G=="function"?G(b,Q.ch):G;te&&Si(Q,te)}}Ie.push(Q)}}return{width:w,height:T,chars:Ie,opt:i}}o(ct,"formatText");function Ri(i){dt(ct(i))}o(Ri,"drawText");function dt(i){ge(),ne(i.opt.pos),ae(i.opt.angle),ne(Rt(i.opt.anchor??"topleft").add(1,1).scale(i.width,i.height).scale(-.5)),i.chars.forEach(s=>{Ye({tex:s.tex,width:s.width,height:s.height,pos:s.pos,scale:s.scale,angle:s.angle,color:s.color,opacity:s.opacity,quad:s.quad,anchor:"center",uniform:i.opt.uniform,shader:i.opt.shader,fixed:i.opt.fixed})}),ce()}o(dt,"drawFormattedText");function be(){return y.width}o(be,"width");function Ee(){return y.height}o(Ee,"height");function ds(i){return new S((i.x-y.viewport.x)*be()/y.viewport.width,(i.y-y.viewport.y)*Ee()/y.viewport.height)}o(ds,"windowToContent");function fs(i){return new S(i.x*y.viewport.width/y.width,i.y*y.viewport.height/y.height)}o(fs,"contentToView");function qt(){return ds(A.mousePos())}o(qt,"mousePos");let ps=!1,he={inspect:!1,timeScale:1,showLog:!0,fps:()=>A.fps(),numFrames:()=>A.numFrames(),stepFrame:ji,drawCalls:()=>y.lastDrawCalls,clearLog:()=>P.logs=[],log:i=>{let s=e.logMax??so;P.logs.unshift({msg:i,time:A.time()}),P.logs.length>s&&(P.logs=P.logs.slice(0,s))},error:i=>he.log(new Error(i.toString?i.toString():i)),curRecording:null,numObjects:()=>Di("*",{recursive:!0}).length,get paused(){return ps},set paused(i){ps=i,i?j.ctx.suspend():j.ctx.resume()}};function Le(){return A.dt()*he.timeScale}o(Le,"dt");function gs(...i){return i.length>0&&(P.cam.pos=B(...i)),P.cam.pos?P.cam.pos.clone():Jt()}o(gs,"camPos");function ms(...i){return i.length>0&&(P.cam.scale=B(...i)),P.cam.scale.clone()}o(ms,"camScale");function ws(i){return i!==void 0&&(P.cam.angle=i),P.cam.angle}o(ws,"camRot");function As(i=12){P.cam.shake+=i}o(As,"shake");function Pi(i){return P.cam.transform.multVec2(i)}o(Pi,"toScreen");function Mi(i){return P.cam.transform.invert().multVec2(i)}o(Mi,"toWorld");function Yt(i){let s=new ke;return i.pos&&s.translate(i.pos),i.scale&&s.scale(i.scale),i.angle&&s.rotate(i.angle),i.parent?s.mult(i.parent.transform):s}o(Yt,"calcTransform");function ni(i=[]){let s=new Map,n={},h=new $t,a=[],u=null,p=!1,v={id:Ln(),hidden:!1,transform:new ke,children:[],parent:null,set paused(c){if(c!==p){p=c;for(let w of a)w.paused=c}},get paused(){return p},add(c=[]){let w=Array.isArray(c)?ni(c):c;if(w.parent)throw new Error("Cannot add a game obj that already has a parent.");return w.parent=this,w.transform=Yt(w),this.children.push(w),w.trigger("add",w),P.events.trigger("add",w),w},readd(c){let w=this.children.indexOf(c);return w!==-1&&(this.children.splice(w,1),this.children.push(c)),c},remove(c){let w=this.children.indexOf(c);if(w!==-1){c.parent=null,this.children.splice(w,1);let T=o(F=>{F.trigger("destroy"),P.events.trigger("destroy",F),F.children.forEach(Y=>T(Y))},"trigger");T(c)}},removeAll(c){if(c)this.get(c).forEach(w=>this.remove(w));else for(let w of[...this.children])this.remove(w)},update(){this.paused||(this.children.sort((c,w)=>(c.z??0)-(w.z??0)).forEach(c=>c.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let c=y.fixed;this.fixed&&(y.fixed=!0),ge(),ne(this.pos),qe(this.scale),ae(this.angle);let w=this.children.sort((T,F)=>(T.z??0)-(F.z??0));if(this.mask){let T={intersect:Ht,subtract:Kt}[this.mask];if(!T)throw new Error(`Invalid mask func: "${this.mask}"`);T(()=>{w.forEach(F=>F.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),w.forEach(T=>T.draw());ce(),y.fixed=c,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(ge(),ne(this.pos),qe(this.scale),ae(this.angle),this.children.sort((c,w)=>(c.z??0)-(w.z??0)).forEach(c=>c.drawInspect()),this.trigger("drawInspect"),ce())},use(c){if(!c)return;if(typeof c=="string")return this.use({id:c});let w=[];c.id&&(this.unuse(c.id),n[c.id]=[],w=n[c.id],s.set(c.id,c));for(let F in c){if(uo.has(F))continue;let Y=Object.getOwnPropertyDescriptor(c,F);if(typeof Y.value=="function"&&(c[F]=c[F].bind(this)),Y.set&&Object.defineProperty(c,F,{set:Y.set.bind(this)}),Y.get&&Object.defineProperty(c,F,{get:Y.get.bind(this)}),co.has(F)){let k=F==="add"?()=>{u=o(O=>w.push(O),"onCurCompCleanup"),c[F](),u=null}:c[F];w.push(this.on(F,k).cancel)}else if(this[F]===void 0)Object.defineProperty(this,F,{get:()=>c[F],set:k=>c[F]=k,configurable:!0,enumerable:!0}),w.push(()=>delete this[F]);else throw new Error(`Duplicate component property: "${F}"`)}let T=o(()=>{if(c.require){for(let F of c.require)if(!this.c(F))throw new Error(`Component "${c.id}" requires component "${F}"`)}},"checkDeps");c.destroy&&w.push(c.destroy.bind(this)),this.exists()?(T(),c.add&&(u=o(F=>w.push(F),"onCurCompCleanup"),c.add.call(this),u=null)):c.require&&w.push(this.on("add",T).cancel)},unuse(c){n[c]&&(n[c].forEach(w=>w()),delete n[c]),s.has(c)&&s.delete(c)},c(c){return s.get(c)},get(c,w={}){let T=w.recursive?this.children.flatMap(o(function F(Y){return[Y,...Y.children.flatMap(F)]},"recurse")):this.children;if(T=T.filter(F=>c?F.is(c):!0),w.liveUpdate){let F=o(k=>w.recursive?this.isAncestorOf(k):k.parent===this,"isChild"),Y=[];Y.push(Bi(k=>{F(k)&&k.is(c)&&T.push(k)})),Y.push(ys(k=>{if(F(k)&&k.is(c)){let O=T.findIndex(H=>H.id===k.id);O!==-1&&T.splice(O,1)}})),this.onDestroy(()=>{for(let k of Y)k.cancel()})}return T},isAncestorOf(c){return c.parent?c.parent===this||this.isAncestorOf(c.parent):!1},exists(){return P.root.isAncestorOf(this)},is(c){if(c==="*")return!0;if(Array.isArray(c)){for(let w of c)if(!this.c(w))return!1;return!0}else return this.c(c)!=null},on(c,w){let T=h.on(c,w.bind(this));return u&&u(()=>T.cancel()),T},trigger(c,...w){h.trigger(c,...w),P.objEvents.trigger(c,this,...w)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let c={};for(let[w,T]of s)c[w]=T.inspect?T.inspect():null;return c},onAdd(c){return this.on("add",c)},onUpdate(c){return this.on("update",c)},onDraw(c){return this.on("draw",c)},onDestroy(c){return this.on("destroy",c)},clearEvents(){h.clear()}},g=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let c of g)v[c]=(...w)=>{let T=A[c](...w);return a.push(T),v.onDestroy(()=>T.cancel()),T};for(let c of i)v.use(c);return v}o(ni,"make");function _e(i,s,n){return P.objEvents[i]||(P.objEvents[i]=new Qr),P.objEvents.on(i,(h,...a)=>{h.is(s)&&n(h,...a)})}o(_e,"on");let yn=Fe(i=>{let s=Zt([{update:i}]);return{get paused(){return s.paused},set paused(n){s.paused=n},cancel:()=>s.destroy()}},(i,s)=>_e("update",i,s)),vn=Fe(i=>{let s=Zt([{draw:i}]);return{get paused(){return s.hidden},set paused(n){s.hidden=n},cancel:()=>s.destroy()}},(i,s)=>_e("draw",i,s)),Bi=Fe(i=>P.events.on("add",i),(i,s)=>_e("add",i,s)),ys=Fe(i=>P.events.on("destroy",i),(i,s)=>_e("destroy",i,s));function vs(i,s,n){return _e("collide",i,(h,a,u)=>a.is(s)&&n(h,a,u))}o(vs,"onCollide");function xs(i,s,n){return _e("collideUpdate",i,(h,a,u)=>a.is(s)&&n(h,a,u))}o(xs,"onCollideUpdate");function Vs(i,s,n){return _e("collideEnd",i,(h,a,u)=>a.is(s)&&n(h,a,u))}o(Vs,"onCollideEnd");function kt(i,s){Di(i,{recursive:!0}).forEach(s),Bi(i,s)}o(kt,"forAllCurrentAndFuture");let xn=Fe(i=>A.onMousePress(i),(i,s)=>{let n=[];return kt(i,h=>{if(!h.area)throw new Error("onClick() requires the object to have area() component");n.push(h.onClick(()=>s(h)))}),Nt.join(n)});function bs(i,s){let n=[];return kt(i,h=>{if(!h.area)throw new Error("onHover() requires the object to have area() component");n.push(h.onHover(()=>s(h)))}),Nt.join(n)}o(bs,"onHover");function Ss(i,s){let n=[];return kt(i,h=>{if(!h.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(h.onHoverUpdate(()=>s(h)))}),Nt.join(n)}o(Ss,"onHoverUpdate");function Es(i,s){let n=[];return kt(i,h=>{if(!h.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(h.onHoverEnd(()=>s(h)))}),Nt.join(n)}o(Es,"onHoverEnd");function Rs(i){P.gravity=i}o(Rs,"setGravity");function Ps(){return P.gravity}o(Ps,"getGravity");function Ms(...i){i.length===1||i.length===2?(y.bgColor=se(i[0]),i[1]&&(y.bgAlpha=i[1])):(i.length===3||i.length===4)&&(y.bgColor=se(i[0],i[1],i[2]),i[3]&&(y.bgAlpha=i[3])),R.clearColor(y.bgColor.r/255,y.bgColor.g/255,y.bgColor.b/255,y.bgAlpha)}o(Ms,"setBackground");function Bs(){return y.bgColor.clone()}o(Bs,"getBackground");function Qt(...i){return{id:"pos",pos:B(...i),moveBy(...s){this.pos=this.pos.add(B(...s))},move(...s){this.moveBy(B(...s).scale(Le()))},moveTo(...s){if(typeof s[0]=="number"&&typeof s[1]=="number")return this.moveTo(B(s[0],s[1]),s[2]);let n=s[0],h=s[1];if(h===void 0){this.pos=B(n);return}let a=n.sub(this.pos);if(a.len()<=h*Le()){this.pos=B(n);return}this.move(a.unit().scale(h))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let s=this.worldPos();return Ct(this)?s:Pi(s)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){X({color:se(255,0,0),radius:4/Ue()})}}}o(Qt,"pos");function Xt(...i){return i.length===0?Xt(1):{id:"scale",scale:B(...i),scaleTo(...s){this.scale=B(...s)},scaleBy(...s){this.scale.scale(B(...s))},inspect(){return`(${Ft(this.scale.x,2)}, ${Ft(this.scale.y,2)})`}}}o(Xt,"scale");function Ts(i){return{id:"rotate",angle:i??0,rotateBy(s){this.angle+=s},rotateTo(s){this.angle=s},inspect(){return`${Math.round(this.angle)}`}}}o(Ts,"rotate");function Is(...i){return{id:"color",color:se(...i),inspect(){return this.color.toString()}}}o(Is,"color");function Ft(i,s){return Number(i.toFixed(s))}o(Ft,"toFixed");function Fs(i){return{id:"opacity",opacity:i??1,inspect(){return`${Ft(this.opacity,1)}`},fadeOut(s=1,n=fi.linear){return Ni(this.opacity,0,s,h=>this.opacity=h,n)}}}o(Fs,"opacity");function oi(i){if(!i)throw new Error("Please define an anchor");return{id:"anchor",anchor:i,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}o(oi,"anchor");function Cs(i){return{id:"z",z:i,inspect(){return`${this.z}`}}}o(Cs,"z");function Ds(i,s){return{id:"follow",require:["pos"],follow:{obj:i,offset:s??B(0)},add(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(Ds,"follow");function Ns(i,s){let n=typeof i=="number"?S.fromAngle(i):i.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(s))}}}o(Ns,"move");let Vn=200;function Os(i={}){let s=i.distance??Vn,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let h=this.screenPos(),a=new Re(B(0),be(),Ee());return!si(a,h)&&a.sdistToPoint(h)>s*s},onExitScreen(h){return this.on("exitView",h)},onEnterScreen(h){return this.on("enterView",h)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),i.hide&&(this.hidden=!0),i.pause&&(this.paused=!0),i.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),i.hide&&(this.hidden=!1),i.pause&&(this.paused=!1))}}}o(Os,"offscreen");function Ct(i){return i.fixed?!0:i.parent?Ct(i.parent):!1}o(Ct,"isFixed");function js(i={}){let s={},n=new Set;return{id:"area",collisionIgnore:i.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>A.setCursor(this.area.cursor)),this.onCollideUpdate((h,a)=>{s[h.id]||this.trigger("collide",h,a),s[h.id]=a,n.add(h.id)})},update(){for(let h in s)n.has(Number(h))||(this.trigger("collideEnd",s[h].target),delete s[h]);n.clear()},drawInspect(){let h=this.localArea();ge(),qe(this.area.scale),ne(this.area.offset);let a={outline:{width:4/Ue(),color:se(0,0,255)},anchor:this.anchor,fill:!1,fixed:Ct(this)};h instanceof Re?Ve({...a,pos:h.pos,width:h.width,height:h.height}):h instanceof _t?we({...a,pts:h.pts}):h instanceof Vr&&X({...a,pos:h.center,radius:h.radius}),ce()},area:{shape:i.shape??null,scale:i.scale?B(i.scale):B(1),offset:i.offset??B(0),cursor:i.cursor??null},isClicked(){return A.isMousePressed()&&this.isHovering()},isHovering(){let h=Ct(this)?qt():Mi(qt());return this.hasPoint(h)},checkCollision(h){return s[h.id]??null},getCollisions(){return Object.values(s)},isColliding(h){return!!s[h.id]},isOverlapping(h){let a=s[h.id];return a&&a.hasOverlap()},onClick(h){let a=A.onMousePress("left",()=>{this.isHovering()&&h()});return this.onDestroy(()=>a.cancel()),a},onHover(h){let a=!1;return this.onUpdate(()=>{a?a=this.isHovering():this.isHovering()&&(a=!0,h())})},onHoverUpdate(h){return this.onUpdate(()=>{this.isHovering()&&h()})},onHoverEnd(h){let a=!1;return this.onUpdate(()=>{a?this.isHovering()||(a=!1,h()):a=this.isHovering()})},onCollide(h,a){if(typeof h=="function"&&a===void 0)return this.on("collide",h);if(typeof h=="string")return this.onCollide((u,p)=>{u.is(h)&&a(u,p)})},onCollideUpdate(h,a){if(typeof h=="function"&&a===void 0)return this.on("collideUpdate",h);if(typeof h=="string")return this.on("collideUpdate",(u,p)=>u.is(h)&&a(u,p))},onCollideEnd(h,a){if(typeof h=="function"&&a===void 0)return this.on("collideEnd",h);if(typeof h=="string")return this.on("collideEnd",u=>u.is(h)&&a(u))},hasPoint(h){return as(this.worldArea(),h)},resolveCollision(h){let a=this.checkCollision(h);a&&!a.resolved&&(this.pos=this.pos.add(a.displacement),a.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let h=this.localArea();if(!(h instanceof _t||h instanceof Re))throw new Error("Only support polygon and rect shapes for now");let a=this.transform.clone().scale(B(this.area.scale??1)).translate(this.area.offset);if(h instanceof Re){let u=Rt(this.anchor||pi).add(1,1).scale(-.5).scale(h.width,h.height);a.translate(u)}return h.transform(a)},screenArea(){let h=this.worldArea();return Ct(this)?h:h.transform(P.cam.transform)}}}o(js,"area");function ft(i){return{color:i.color,opacity:i.opacity,anchor:i.anchor,outline:i.outline,shader:i.shader,uniform:i.uniform}}o(ft,"getRenderProps");function ai(i,s={}){let n=null,h=null,a=null,u=new Ge;if(!i)throw new Error("Please pass the resource name or data to sprite()");let p=o((v,g,c,w)=>{let T=B(1,1);return c&&w?(T.x=c/(v.width*g.w),T.y=w/(v.height*g.h)):c?(T.x=c/(v.width*g.w),T.y=T.x):w&&(T.y=w/(v.height*g.h),T.x=T.y),T},"calcTexScale");return{id:"sprite",width:0,height:0,frame:s.frame||0,quad:s.quad||new ve(0,0,1,1),animSpeed:s.animSpeed??1,flipX:s.flipX??!1,flipY:s.flipY??!1,draw(){if(!n)return;let v=n.frames[this.frame??0];if(!v)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:g,right:c,top:w,bottom:T}=n.slice9,F=n.tex.width*v.w,Y=n.tex.height*v.h,k=this.width-g-c,O=this.height-w-T,H=g/F,Ie=c/F,$=1-H-Ie,ee=w/Y,Q=T/Y,Ae=1-ee-Q,b=[pe(0,0,H,ee),pe(H,0,$,ee),pe(H+$,0,Ie,ee),pe(0,ee,H,Ae),pe(H,ee,$,Ae),pe(H+$,ee,Ie,Ae),pe(0,ee+Ae,H,Q),pe(H,ee+Ae,$,Q),pe(H+$,ee+Ae,Ie,Q),pe(0,0,g,w),pe(g,0,k,w),pe(g+k,0,c,w),pe(0,w,g,O),pe(g,w,k,O),pe(g+k,w,c,O),pe(0,w+O,g,T),pe(g,w+O,k,T),pe(g+k,w+O,c,T)];for(let C=0;C<9;C++){let N=b[C],G=b[C+9];ut(Object.assign(ft(this),{pos:G.pos(),tex:n.tex,quad:v.scale(N),flipX:this.flipX,flipY:this.flipY,tiled:s.tiled,width:G.w,height:G.h}))}}else ut(Object.assign(ft(this),{tex:n.tex,quad:v.scale(this.quad??new ve(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:s.tiled,width:this.width,height:this.height}))},add(){let v=o(c=>{let w=c.frames[0].clone();s.quad&&(w=w.scale(s.quad));let T=p(c.tex,w,s.width,s.height);this.width=c.tex.width*w.w*T.x,this.height=c.tex.height*w.h*T.y,s.anim&&this.play(s.anim),n=c,u.trigger(n)},"setSpriteData"),g=Je(i);g?g.onLoad(v):li(()=>v(Je(i).data))},update(){if(!h)return;let v=n.anims[h.name];if(typeof v=="number"){this.frame=v;return}if(v.speed===0)throw new Error("Sprite anim speed cannot be 0");h.timer+=Le()*this.animSpeed,h.timer>=1/h.speed&&(h.timer=0,this.frame+=a,(this.frame<Math.min(v.from,v.to)||this.frame>Math.max(v.from,v.to))&&(h.loop?h.pingpong?(this.frame-=a,a*=-1,this.frame+=a):this.frame=v.from:(this.frame=v.to,h.onEnd(),this.stop())))},play(v,g={}){if(!n){u.add(()=>this.play(v,g));return}let c=n.anims[v];if(c===void 0)throw new Error(`Anim not found: ${v}`);h&&this.stop(),h=typeof c=="number"?{name:v,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:v,timer:0,loop:g.loop??c.loop??!1,pingpong:g.pingpong??c.pingpong??!1,speed:g.speed??c.speed??10,onEnd:g.onEnd??(()=>{})},a=typeof c=="number"?null:c.from<c.to?1:-1,this.frame=typeof c=="number"?c:c.from,this.trigger("animStart",v)},stop(){if(!h)return;let v=h.name;h=null,this.trigger("animEnd",v)},numFrames(){return n?.frames.length??0},curAnim(){return h?.name},onAnimEnd(v){return this.on("animEnd",v)},onAnimStart(v){return this.on("animStart",v)},renderArea(){return new Re(B(0),this.width,this.height)},inspect(){if(typeof i=="string")return`"${i}"`}}}o(ai,"sprite");function Us(i,s={}){function n(a){let u=ct(Object.assign(ft(a),{text:a.text+"",size:a.textSize,font:a.font,width:s.width&&a.width,align:a.align,letterSpacing:a.letterSpacing,lineSpacing:a.lineSpacing,transform:a.textTransform,styles:a.textStyles}));return s.width||(a.width=u.width/(a.scale?.x||1)),a.height=u.height/(a.scale?.y||1),u}o(n,"update");let h={id:"text",set text(a){i=a,n(this)},get text(){return i},textSize:s.size??to,font:s.font,width:s.width??0,height:0,align:s.align,lineSpacing:s.lineSpacing,letterSpacing:s.letterSpacing,textTransform:s.transform,textStyles:s.styles,add(){li(()=>n(this))},draw(){dt(n(this))},renderArea(){return new Re(B(0),this.width,this.height)}};return n(h),h}o(Us,"text");function Ls(i,s={}){if(i.length<3)throw new Error(`Polygon's need more than two points, ${i.length} points provided`);return{id:"polygon",pts:i,colors:s.colors,radius:s.radius,draw(){we(Object.assign(ft(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:s.fill}))},renderArea(){return new _t(this.pts)},inspect(){return this.pts.map(n=>`[${n.x},${n.y}]`).join(",")}}}o(Ls,"polygon");function Gs(i,s,n={}){return{id:"rect",width:i,height:s,radius:n.radius||0,draw(){Ve(Object.assign(ft(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new Re(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Gs,"rect");function zs(i,s){return{id:"rect",width:i,height:s,draw(){Ye(Object.assign(ft(this),{width:this.width,height:this.height}))},renderArea(){return new Re(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(zs,"uvquad");function Hs(i,s={}){return{id:"circle",radius:i,draw(){X(Object.assign(ft(this),{radius:this.radius,fill:s.fill}))},renderArea(){return new Re(new S(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}o(Hs,"circle");function Ks(i=1,s=se(0,0,0)){return{id:"outline",outline:{width:i,color:s}}}o(Ks,"outline");function hi(){return{id:"timer",wait(i,s){let n=[];s&&n.push(s);let h=0,a=this.onUpdate(()=>{h+=Le(),h>=i&&(n.forEach(u=>u()),a.cancel())});return{get paused(){return a.paused},set paused(u){a.paused=u},cancel:a.cancel,onEnd(u){n.push(u)},then(u){return this.onEnd(u),this}}},loop(i,s){let n=null,h=o(()=>{n=this.wait(i,h),s()},"newAction");return n=this.wait(0,h),{get paused(){return n.paused},set paused(a){n.paused=a},cancel:()=>n.cancel()}},tween(i,s,n,h,a=fi.linear){let u=0,p=[],v=this.onUpdate(()=>{u+=Le();let g=Math.min(u/n,1);h(it(i,s,a(g))),g===1&&(v.cancel(),h(s),p.forEach(c=>c()))});return{get paused(){return v.paused},set paused(g){v.paused=g},onEnd(g){p.push(g)},then(g){return this.onEnd(g),this},cancel(){v.cancel()},finish(){v.cancel(),h(s),p.forEach(g=>g())}}}}}o(hi,"timer");let bn=640,Sn=65536;function qs(i={}){let s=null,n=null,h=!1;return{id:"body",require:["pos","area"],vel:new S(0),jumpForce:i.jumpForce??bn,gravityScale:i.gravityScale??1,isStatic:i.isStatic??!1,mass:i.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((a,u)=>{if(a.is("body")&&!u.resolved&&(this.trigger("beforePhysicsResolve",u),a.trigger("beforePhysicsResolve",u.reverse()),!u.resolved&&!(this.isStatic&&a.isStatic))){if(!this.isStatic&&!a.isStatic){let p=this.mass+a.mass;this.pos=this.pos.add(u.displacement.scale(a.mass/p)),a.pos=a.pos.add(u.displacement.scale(-this.mass/p)),this.transform=Yt(this),a.transform=Yt(a)}else{let p=!this.isStatic&&a.isStatic?u:u.reverse();p.source.pos=p.source.pos.add(p.displacement),p.source.transform=Yt(p.source)}u.resolved=!0,this.trigger("physicsResolve",u),a.trigger("physicsResolve",u.reverse())}}),this.onPhysicsResolve(a=>{P.gravity&&(a.isBottom()&&this.isFalling()?(this.vel.y=0,s=a.target,n=a.target.pos,h?h=!1:this.trigger("ground",s)):a.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",a.target)))})},update(){if(!P.gravity||this.isStatic)return;if(h&&(s=null,n=null,this.trigger("fallOff"),h=!1),s)if(!this.isColliding(s)||!s.exists()||!s.is("body"))h=!0;else{!s.pos.eq(n)&&i.stickToPlatform!==!1&&this.moveBy(s.pos.sub(n)),n=s.pos;return}let a=this.vel.y;this.vel.y+=P.gravity*this.gravityScale*Le(),this.vel.y=Math.min(this.vel.y,i.maxVelocity??Sn),a<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(a){return this.on("physicsResolve",a)},onBeforePhysicsResolve(a){return this.on("beforePhysicsResolve",a)},curPlatform(){return s},isGrounded(){return s!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(a){s=null,n=null,this.vel.y=-a||-this.jumpForce},onGround(a){return this.on("ground",a)},onFall(a){return this.on("fall",a)},onFallOff(a){return this.on("fallOff",a)},onHeadbutt(a){return this.on("headbutt",a)}}}o(qs,"body");function Ys(i=2){let s=i;return{id:"doubleJump",require:["body"],numJumps:i,add(){this.onGround(()=>{s=this.numJumps})},doubleJump(n){s<=0||(s<this.numJumps&&this.trigger("doubleJump"),s--,this.jump(n))},onDoubleJump(n){return this.on("doubleJump",n)},inspect(){return`${s}`}}}o(Ys,"doubleJump");function ks(i,s){return{id:"shader",shader:i,...typeof s=="function"?{uniform:s(),update(){this.uniform=s()}}:{uniform:s}}}o(ks,"shader");function Qs(){return{id:"fixed",fixed:!0}}o(Qs,"fixed");function Ti(i){return{id:"stay",stay:!0,scenesToStay:i}}o(Ti,"stay");function Xs(i,s){if(i==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(n=1){this.setHP(i-n),this.trigger("hurt",n)},heal(n=1){let h=i;this.setHP(i+n),this.trigger("heal",i-h)},hp(){return i},maxHP(){return s??null},setMaxHP(n){s=n},setHP(n){i=s?Math.min(s,n):n,i<=0&&this.trigger("death")},onHurt(n){return this.on("hurt",n)},onHeal(n){return this.on("heal",n)},onDeath(n){return this.on("death",n)},inspect(){return`${i}`}}}o(Xs,"health");function Js(i,s={}){if(i==null)throw new Error("lifespan() requires time");let n=s.fade??0;return{id:"lifespan",async add(){await lr(i),n>0&&this.opacity&&await Ni(this.opacity,0,n,h=>this.opacity=h,fi.linear),this.destroy()}}}o(Js,"lifespan");function Zs(i,s,n){if(!i)throw new Error("state() requires an initial state");let h={};function a(g){h[g]||(h[g]={enter:new Ge,end:new Ge,update:new Ge,draw:new Ge})}o(a,"initStateEvents");function u(g,c,w){return a(c),h[c][g].add(w)}o(u,"on");function p(g,c,...w){a(c),h[c][g].trigger(...w)}o(p,"trigger");let v=!1;return{id:"state",state:i,enterState(g,...c){if(v=!0,s&&!s.includes(g))throw new Error(`State not found: ${g}`);let w=this.state;if(n){if(!n?.[w])return;let T=typeof n[w]=="string"?[n[w]]:n[w];if(!T.includes(g))throw new Error(`Cannot transition state from "${w}" to "${g}". Available transitions: ${T.map(F=>`"${F}"`).join(", ")}`)}p("end",w,...c),this.state=g,p("enter",g,...c),p("enter",`${w} -> ${g}`,...c)},onStateTransition(g,c,w){return u("enter",`${g} -> ${c}`,w)},onStateEnter(g,c){return u("enter",g,c)},onStateUpdate(g,c){return u("update",g,c)},onStateDraw(g,c){return u("draw",g,c)},onStateEnd(g,c){return u("end",g,c)},update(){v||(p("enter",i),v=!0),p("update",this.state)},draw(){p("draw",this.state)},inspect(){return this.state}}}o(Zs,"state");function Ws(i=1){let s=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(s+=Le(),this.opacity=gt(s,0,i,0,1),s>=i&&(this.opacity=1,n=!0))}}}o(Ws,"fadeIn");function _s(i="intersect"){return{id:"mask",mask:i}}o(_s,"mask");function $s(i){return{add(){this.canvas=i}}}o($s,"drawon");function li(i){D.loaded?i():P.events.on("load",i)}o(li,"onLoad");function er(i,s){P.scenes[i]=s}o(er,"scene");function tr(i,...s){if(!P.scenes[i])throw new Error(`Scene not found: ${i}`);P.events.onOnce("frameEnd",()=>{P.events.trigger("sceneLeave",i),A.events.clear(),P.events.clear(),P.objEvents.clear(),[...P.root.children].forEach(n=>{(!n.stay||n.scenesToStay&&!n.scenesToStay.includes(i))&&P.root.remove(n)}),P.root.clearEvents(),zi(),P.cam={pos:null,scale:B(1),angle:0,shake:0,transform:new ke},P.scenes[i](...s)})}o(tr,"go");function ir(i){return P.events.on("sceneLeave",i)}o(ir,"onSceneLeave");function sr(i,s){try{return JSON.parse(window.localStorage[i])}catch{return s?(Ii(i,s),s):null}}o(sr,"getData");function Ii(i,s){window.localStorage[i]=JSON.stringify(s)}o(Ii,"setData");function Fi(i,...s){let n=i(St),h;typeof n=="function"?h=n(...s)(St):h=n;for(let a in h)St[a]=h[a],e.global!==!1&&(window[a]=h[a]);return St}o(Fi,"plug");function Jt(){return B(be()/2,Ee()/2)}o(Jt,"center");let En;(i=>(i[i.None=0]="None",i[i.Left=1]="Left",i[i.Top=2]="Top",i[i.LeftTop=3]="LeftTop",i[i.Right=4]="Right",i[i.Horizontal=5]="Horizontal",i[i.RightTop=6]="RightTop",i[i.HorizontalTop=7]="HorizontalTop",i[i.Bottom=8]="Bottom",i[i.LeftBottom=9]="LeftBottom",i[i.Vertical=10]="Vertical",i[i.LeftVertical=11]="LeftVertical",i[i.RightBottom=12]="RightBottom",i[i.HorizontalBottom=13]="HorizontalBottom",i[i.RightVertical=14]="RightVertical",i[i.All=15]="All"))(En||={});function Ci(i={}){let s=B(0),n=i.isObstacle??!1,h=i.cost??0,a=i.edges??[],u=o(()=>{let v={left:1,top:2,right:4,bottom:8};return a.map(g=>v[g]||0).reduce((g,c)=>g|c,0)},"getEdgeMask"),p=u();return{id:"tile",tilePosOffset:i.offset??B(0),set tilePos(v){let g=this.getLevel();s=v.clone(),this.pos=B(this.tilePos.x*g.tileWidth(),this.tilePos.y*g.tileHeight()).add(this.tilePosOffset)},get tilePos(){return s},set isObstacle(v){n!==v&&(n=v,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(v){h!==v&&(h=v,this.getLevel().invalidateNavigationMap())},get cost(){return h},set edges(v){a=v,p=u(),this.getLevel().invalidateNavigationMap()},get edges(){return a},get edgeMask(){return p},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(B(-1,0))},moveRight(){this.tilePos=this.tilePos.add(B(1,0))},moveUp(){this.tilePos=this.tilePos.add(B(0,-1))},moveDown(){this.tilePos=this.tilePos.add(B(0,1))}}}o(Ci,"tile");function rr(i,s){if(!s.tileWidth||!s.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=Zt([Qt(s.pos??B(0))]),h=i.length,a=0,u=null,p=null,v=null,g=null,c=o(b=>b.x+b.y*a,"tile2Hash"),w=o(b=>B(Math.floor(b%a),Math.floor(b/a)),"hash2Tile"),T=o(()=>{u=[];for(let b of n.children)F(b)},"createSpatialMap"),F=o(b=>{let C=c(b.tilePos);u[C]?u[C].push(b):u[C]=[b]},"insertIntoSpatialMap"),Y=o(b=>{let C=c(b.tilePos);if(u[C]){let N=u[C].indexOf(b);N>=0&&u[C].splice(N,1)}},"removeFromSpatialMap"),k=o(()=>{let b=!1;for(let C of n.children){let N=n.pos2Tile(C.pos);(C.tilePos.x!=N.x||C.tilePos.y!=N.y)&&(b=!0,Y(C),C.tilePos.x=N.x,C.tilePos.y=N.y,F(C))}b&&n.trigger("spatial_map_changed")},"updateSpatialMap"),O=o(()=>{let b=n.getSpatialMap(),C=n.numRows()*n.numColumns();p?p.length=C:p=new Array(C),p.fill(1,0,C);for(let N=0;N<b.length;N++){let G=b[N];if(G){let te=0;for(let re of G)if(re.isObstacle){te=1/0;break}else te+=re.cost;p[N]=te||1}}},"createCostMap"),H=o(()=>{let b=n.getSpatialMap(),C=n.numRows()*n.numColumns();v?v.length=C:v=new Array(C),v.fill(15,0,C);for(let N=0;N<b.length;N++){let G=b[N];if(G){let te=G.length,re=15;for(let fe=0;fe<te;fe++)re|=G[fe].edgeMask;v[N]=re}}},"createEdgeMap"),Ie=o(()=>{let b=n.numRows()*n.numColumns(),C=o((G,te)=>{let re=[];for(re.push(G);re.length>0;){let fe=re.pop();Q(fe).forEach(ye=>{g[ye]<0&&(g[ye]=te,re.push(ye))})}},"traverse");g?g.length=b:g=new Array(b),g.fill(-1,0,b);let N=0;for(let G=0;G<p.length;G++){if(g[G]>=0){N++;continue}C(G,N),N++}},"createConnectivityMap"),$=o((b,C)=>p[C],"getCost"),ee=o((b,C)=>{let N=w(b),G=w(C);return N.dist(G)},"getHeuristic"),Q=o((b,C)=>{let N=[],G=Math.floor(b%a),te=G>0&&v[b]&1&&p[b-1]!==1/0,re=b>=a&&v[b]&2&&p[b-a]!==1/0,fe=G<a-1&&v[b]&4&&p[b+1]!==1/0,ye=b<a*h-a-1&&v[b]&8&&p[b+a]!==1/0;return C?(te&&(re&&N.push(b-a-1),N.push(b-1),ye&&N.push(b+a-1)),re&&N.push(b-a),fe&&(re&&N.push(b-a+1),N.push(b+1),ye&&N.push(b+a+1)),ye&&N.push(b+a)):(te&&N.push(b-1),re&&N.push(b-a),fe&&N.push(b+1),ye&&N.push(b+a)),N},"getNeighbours"),Ae={id:"level",tileWidth(){return s.tileWidth},tileHeight(){return s.tileHeight},spawn(b,...C){let N=B(...C),G=(()=>{if(typeof b=="string"){if(s.tiles[b]){if(typeof s.tiles[b]!="function")throw new Error("Level symbol def must be a function returning a component list");return s.tiles[b](N)}else if(s.wildcardTile)return s.wildcardTile(b,N)}else{if(Array.isArray(b))return b;throw new Error("Expected a symbol or a component list")}})();if(!G)return null;let te=!1,re=!1;for(let ye of G)ye.id==="tile"&&(re=!0),ye.id==="pos"&&(te=!0);te||G.push(Qt()),re||G.push(Ci());let fe=n.add(G);return te&&(fe.tilePosOffset=fe.pos.clone()),fe.tilePos=N,u&&(F(fe),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),fe},numColumns(){return a},numRows(){return h},levelWidth(){return a*this.tileWidth()},levelHeight(){return h*this.tileHeight()},tile2Pos(...b){return B(...b).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...b){let C=B(...b);return B(Math.floor(C.x/this.tileWidth()),Math.floor(C.y/this.tileHeight()))},getSpatialMap(){return u||T(),u},onSpatialMapChanged(b){return this.on("spatial_map_changed",b)},onNavigationMapInvalid(b){return this.on("navigation_map_invalid",b)},getAt(b){u||T();let C=c(b);return u[C]||[]},update(){u&&k()},invalidateNavigationMap(){p=null,v=null,g=null},onNavigationMapChanged(b){return this.on("navigation_map_changed",b)},getTilePath(b,C,N={}){if(p||O(),v||H(),g||Ie(),b.x<0||b.x>=a||b.y<0||b.y>=h||C.x<0||C.x>=a||C.y<0||C.y>=h)return null;let G=c(b),te=c(C);if(p[te]===1/0)return null;if(G===te)return[];if(g[G]!=-1&&g[G]!==g[te])return null;let re=new zn(($e,Ki)=>$e.cost<Ki.cost);re.insert({cost:0,node:G});let fe=new Map;fe.set(G,G);let ye=new Map;for(ye.set(G,0);re.length!==0;){let $e=re.remove()?.node;if($e===te)break;let Ki=Q($e,N.allowDiagonals);for(let Et of Ki){let qi=(ye.get($e)||0)+$($e,Et)+ee(Et,te);(!ye.has(Et)||qi<ye.get(Et))&&(ye.set(Et,qi),re.insert({cost:qi,node:Et}),fe.set(Et,$e))}}let Hi=[],Wt=te,In=w(Wt);for(Hi.push(In);Wt!==G;){Wt=fe.get(Wt);let $e=w(Wt);Hi.push($e)}return Hi.reverse()},getPath(b,C,N={}){let G=this.tileWidth(),te=this.tileHeight(),re=this.getTilePath(this.pos2Tile(b),this.pos2Tile(C),N);return re?[b,...re.slice(1,-1).map(fe=>fe.scale(G,te).add(G/2,te/2)),C]:null}};return n.use(Ae),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger("navigation_map_changed")}),i.forEach((b,C)=>{let N=b.split("");a=Math.max(N.length,a),N.forEach((G,te)=>{n.spawn(G,B(te,C))})}),n}o(rr,"addLevel");function nr(i={}){let s=null,n=null,h=null,a=null;return{id:"agent",require:["pos","tile"],agentSpeed:i.speed??100,allowDiagonals:i.allowDiagonals??!0,getDistanceToTarget(){return s?this.pos.dist(s):0},getNextLocation(){return n&&h?n[h]:null},getPath(){return n?n.slice():null},getTarget(){return s},isNavigationFinished(){return n?h===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return s?this.pos.eq(s):!0},setTarget(u){s=u,n=this.getLevel().getPath(this.pos,s,{allowDiagonals:this.allowDiagonals}),h=n?0:null,n?(a||(a=this.getLevel().onNavigationMapChanged(()=>{n&&h!==null&&(n=this.getLevel().getPath(this.pos,s,{allowDiagonals:this.allowDiagonals}),h=n?0:null,n?this.trigger("navigation-next",this,n[h]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>a.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[h])):this.trigger("navigation-ended",this)},update(){if(n&&h!==null){if(this.pos.sdist(n[h])<2)if(h===n.length-1){this.pos=s.clone(),h=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else h++,this.trigger("navigation-next",this,n[h]);this.moveTo(n[h],this.agentSpeed)}},onNavigationStarted(u){return this.on("navigation-started",u)},onNavigationNext(u){return this.on("navigation-next",u)},onNavigationEnded(u){return this.on("navigation-ended",u)},onTargetReached(u){return this.on("target-reached",u)},inspect(){return JSON.stringify({target:JSON.stringify(s),path:JSON.stringify(n)})}}}o(nr,"agent");function or(i){let s=A.canvas.captureStream(i),n=j.ctx.createMediaStreamDestination();j.masterNode.connect(n);let h=new MediaRecorder(s),a=[];return h.ondataavailable=u=>{u.data.size>0&&a.push(u.data)},h.onerror=()=>{j.masterNode.disconnect(n),s.getTracks().forEach(u=>u.stop())},h.start(),{resume(){h.resume()},pause(){h.pause()},stop(){return h.stop(),j.masterNode.disconnect(n),s.getTracks().forEach(u=>u.stop()),new Promise(u=>{h.onstop=()=>{u(new Blob(a,{type:"video/mp4"}))}})},download(u="kaboom.mp4"){this.stop().then(p=>ts(u,p))}}}o(or,"record");function ar(){return document.activeElement===A.canvas}o(ar,"isFocused");function hr(i){i.destroy()}o(hr,"destroy");let Zt=P.root.add.bind(P.root),Rn=P.root.readd.bind(P.root),Pn=P.root.removeAll.bind(P.root),Di=P.root.get.bind(P.root),lr=P.root.wait.bind(P.root),Mn=P.root.loop.bind(P.root),Ni=P.root.tween.bind(P.root);function Oi(i=2,s=1){let n=0;return{require:["scale"],update(){let h=Math.sin(n*i)*s;h<0&&this.destroy(),this.scale=B(h),n+=Le()}}}o(Oi,"boom");let Bn=je(null,Wn),Tn=je(null,_n);function ur(i,s={}){let n=Zt([Qt(i),Ti()]),h=(s.speed||1)*5,a=s.scale||1;n.add([ai(Tn),Xt(0),oi("center"),Oi(h,a),...s.comps??[]]);let u=n.add([ai(Bn),Xt(0),oi("center"),hi(),...s.comps??[]]);return u.wait(.4/h,()=>u.use(Oi(h,a))),u.onDestroy(()=>n.destroy()),n}o(ur,"addKaboom");function ji(){P.root.update()}o(ji,"updateFrame");class Ui{static{o(this,"Collision")}source;target;displacement;resolved=!1;constructor(s,n,h,a=!1){this.source=s,this.target=n,this.displacement=h,this.resolved=a}reverse(){return new Ui(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function cr(){let i={},s=e.hashGridSize||io,n=new ke,h=[];function a(u){if(h.push(n.clone()),u.pos&&n.translate(u.pos),u.scale&&n.scale(u.scale),u.angle&&n.rotate(u.angle),u.transform=n.clone(),u.c("area")&&!u.paused){let p=u,v=p.worldArea().bbox(),g=Math.floor(v.pos.x/s),c=Math.floor(v.pos.y/s),w=Math.ceil((v.pos.x+v.width)/s),T=Math.ceil((v.pos.y+v.height)/s),F=new Set;for(let Y=g;Y<=w;Y++)for(let k=c;k<=T;k++)if(!i[Y])i[Y]={},i[Y][k]=[p];else if(!i[Y][k])i[Y][k]=[p];else{let O=i[Y][k];e:for(let H of O){if(H.paused||!H.exists()||F.has(H.id))continue;for(let $ of p.collisionIgnore)if(H.is($))continue e;for(let $ of H.collisionIgnore)if(p.is($))continue e;let Ie=kr(p.worldArea(),H.worldArea());if(Ie){let $=new Ui(p,H,Ie);p.trigger("collideUpdate",H,$);let ee=$.reverse();ee.resolved=$.resolved,H.trigger("collideUpdate",p,ee)}F.add(H.id)}O.push(p)}}u.children.forEach(a),n=h.pop()}o(a,"checkObj"),a(P.root)}o(cr,"checkFrame");function dr(){let i=P.cam,s=S.fromAngle(ii(0,360)).scale(i.shake);i.shake=it(i.shake,0,5*Le()),i.transform=new ke().translate(Jt()).scale(i.scale).rotate(i.angle).translate((i.pos??Jt()).scale(-1).add(s)),P.root.draw(),De()}o(dr,"drawFrame");function fr(){let i=L();P.events.numListeners("loading")>0?P.events.trigger("loading",i):Te(()=>{let s=be()/2,n=24,h=B(be()/2,Ee()/2).sub(B(s/2,n/2));Ve({pos:B(0),width:be(),height:Ee(),color:se(0,0,0)}),Ve({pos:h,width:s,height:n,fill:!1,outline:{width:4}}),Ve({pos:h,width:s*i,height:n})})}o(fr,"drawLoadScreen");function Li(i,s){Te(()=>{let n=B(8);ge(),ne(i);let h=ct({text:s,font:gi,size:16,pos:n,color:se(255,255,255),fixed:!0}),a=h.width+n.x*2,u=h.height+n.x*2;i.x+a>=be()&&ne(B(-a,0)),i.y+u>=Ee()&&ne(B(0,-u)),Ve({width:a,height:u,color:se(0,0,0),radius:4,opacity:.8,fixed:!0}),dt(h),ce()})}o(Li,"drawInspectText");function pr(){if(he.inspect){let i=null;for(let s of P.root.get("*",{recursive:!0}))if(s.c("area")&&s.isHovering()){i=s;break}if(P.root.drawInspect(),i){let s=[],n=i.inspect();for(let h in n)n[h]?s.push(`${h}: ${n[h]}`):s.push(`${h}`);Li(fs(qt()),s.join(`
`))}Li(B(8),`FPS: ${he.fps()}`)}he.paused&&Te(()=>{ge(),ne(be(),0),ne(-8,8);let i=32;Ve({width:i,height:i,anchor:"topright",color:se(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=1;s<=2;s++)Ve({width:4,height:i*.6,anchor:"center",pos:B(-i/3*s,i*.5),color:se(255,255,255),radius:2,fixed:!0});ce()}),he.timeScale!==1&&Te(()=>{ge(),ne(be(),Ee()),ne(-8,-8);let i=8,s=ct({text:he.timeScale.toFixed(1),font:gi,size:16,color:se(255,255,255),pos:B(-i),anchor:"botright",fixed:!0});Ve({width:s.width+i*2+i*4,height:s.height+i*2,anchor:"botright",color:se(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let h=he.timeScale<1;M({p1:B(-s.width-i*(h?2:3.5),-i),p2:B(-s.width-i*(h?2:3.5),-i-s.height),p3:B(-s.width-i*(h?3.5:2),-i-s.height/2),pos:B(-n*i*1+(h?-i*.5:0),0),color:se(255,255,255),fixed:!0})}dt(s),ce()}),he.curRecording&&Te(()=>{ge(),ne(0,Ee()),ne(24,-24),X({radius:12,color:se(255,0,0),opacity:Ji(0,1,A.time()*4),fixed:!0}),ce()}),he.showLog&&P.logs.length>0&&Te(()=>{ge(),ne(0,Ee()),ne(8,-8);let i=8,s=[];for(let h of P.logs){let a="",u=h.msg instanceof Error?"error":"info";a+=`[time]${h.time.toFixed(2)}[/time]`,a+=" ",a+=`[${u}]${h.msg?.toString?h.msg.toString():h.msg}[/${u}]`,s.push(a)}P.logs=P.logs.filter(h=>A.time()-h.time<(e.logTime||ro));let n=ct({text:s.join(`
`),font:gi,pos:B(i,-i),anchor:"botleft",size:16,width:be()*.6,lineSpacing:i/2,fixed:!0,styles:{time:{color:se(127,127,127)},info:{color:se(255,255,255)},error:{color:se(255,0,127)}}});Ve({width:n.width+i*2,height:n.height+i*2,anchor:"botleft",color:se(0,0,0),radius:4,opacity:.8,fixed:!0}),dt(n),ce()})}o(pr,"drawDebug");function gr(i){P.events.on("loading",i)}o(gr,"onLoading");function mr(i){A.onResize(i)}o(mr,"onResize");function wr(i){P.events.on("error",i)}o(wr,"onError");function Ar(i){console.error(i),j.ctx.suspend(),A.run(()=>{Vt(),Te(()=>{let s=be(),n=Ee(),h={size:36,width:s-32*2,letterSpacing:4,lineSpacing:4,font:gi,fixed:!0};Ve({width:s,height:n,color:se(0,0,255),fixed:!0});let a=ct({...h,text:"Error",pos:B(32),color:se(255,128,0),fixed:!0});dt(a),Ri({...h,text:i.message,pos:B(32,32+a.height+16),fixed:!0}),ce(),P.events.trigger("error",i)}),bt()})}o(Ar,"handleErr");function yr(i){Z.push(i)}o(yr,"onCleanup");function vr(){P.events.onOnce("frameEnd",()=>{A.quit(),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT|R.STENCIL_BUFFER_BIT);let i=R.getParameter(R.MAX_TEXTURE_IMAGE_UNITS);for(let s=0;s<i;s++)R.activeTexture(R.TEXTURE0+s),R.bindTexture(R.TEXTURE_2D,null),R.bindTexture(R.TEXTURE_CUBE_MAP,null);R.bindBuffer(R.ARRAY_BUFFER,null),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,null),R.bindRenderbuffer(R.RENDERBUFFER,null),R.bindFramebuffer(R.FRAMEBUFFER,null),z.destroy(),Z.forEach(s=>s())})}o(vr,"quit");let ui=!0;A.run(()=>{try{D.loaded||L()===1&&!ui&&(D.loaded=!0,P.events.trigger("load")),!D.loaded&&e.loadingScreen!==!1||ui?(Vt(),fr(),bt()):(he.paused||ji(),cr(),Vt(),dr(),e.debug!==!1&&pr(),bt()),ui&&(ui=!1),P.events.trigger("frameEnd")}catch(i){Ar(i)}});function Gi(){let i=E,s=R.drawingBufferWidth/i,n=R.drawingBufferHeight/i;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let h=s/n,a=e.width/e.height;if(h>a){let u=n*a,p=(s-u)/2;y.viewport={x:p,y:0,width:u,height:n}}else{let u=s/a,p=(n-u)/2;y.viewport={x:0,y:p,width:s,height:u}}return}if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");y.viewport={x:0,y:0,width:s,height:n}}o(Gi,"updateViewport");function zi(){A.onHide(()=>{e.backgroundAudio||j.ctx.suspend()}),A.onShow(()=>{!e.backgroundAudio&&!he.paused&&j.ctx.resume()}),A.onResize(()=>{if(A.isFullscreen())return;let i=e.width&&e.height;i&&!e.stretch&&!e.letterbox||(r.width=r.offsetWidth*E,r.height=r.offsetHeight*E,Gi(),i||(y.frameBuffer.free(),y.frameBuffer=new ci(z,R.drawingBufferWidth,R.drawingBufferHeight),y.width=R.drawingBufferWidth/E,y.height=R.drawingBufferHeight/E))}),e.debug!==!1&&(A.onKeyPress("f1",()=>he.inspect=!he.inspect),A.onKeyPress("f2",()=>he.clearLog()),A.onKeyPress("f8",()=>he.paused=!he.paused),A.onKeyPress("f7",()=>{he.timeScale=Ft(tt(he.timeScale-.2,0,2),1)}),A.onKeyPress("f9",()=>{he.timeScale=Ft(tt(he.timeScale+.2,0,2),1)}),A.onKeyPress("f10",()=>he.stepFrame())),e.burp&&A.onKeyPress("b",()=>Bt())}o(zi,"initEvents"),Gi(),zi();let St={VERSION:$n,loadRoot:K,loadProgress:L,loadSprite:je,loadSpriteAtlas:le,loadSound:rt,loadBitmapFont:Me,loadFont:Oe,loadShader:Se,loadShaderURL:ze,loadAseprite:xe,loadPedit:wt,loadBean:He,loadJSON:q,load:x,getSprite:nt,getSound:Ke,getFont:At,getBitmapFont:ot,getShader:Xe,getAsset:yt,Asset:Ne,SpriteData:J,SoundData:ue,width:be,height:Ee,center:Jt,dt:Le,time:A.time,screenshot:A.screenshot,record:or,isFocused:ar,setCursor:A.setCursor,getCursor:A.getCursor,setCursorLocked:A.setCursorLocked,isCursorLocked:A.isCursorLocked,setFullscreen:A.setFullscreen,isFullscreen:A.isFullscreen,isTouchscreen:A.isTouchscreen,onLoad:li,onLoading:gr,onResize:mr,onGamepadConnect:A.onGamepadConnect,onGamepadDisconnect:A.onGamepadDisconnect,onError:wr,onCleanup:yr,camPos:gs,camScale:ms,camRot:ws,shake:As,toScreen:Pi,toWorld:Mi,setGravity:Rs,getGravity:Ps,setBackground:Ms,getBackground:Bs,getGamepads:A.getGamepads,add:Zt,make:ni,destroy:hr,destroyAll:Pn,get:Di,readd:Rn,pos:Qt,scale:Xt,rotate:Ts,color:Is,opacity:Fs,anchor:oi,area:js,sprite:ai,text:Us,polygon:Ls,rect:Gs,circle:Hs,uvquad:zs,outline:Ks,body:qs,doubleJump:Ys,shader:ks,timer:hi,fixed:Qs,stay:Ti,health:Xs,lifespan:Js,z:Cs,move:Ns,offscreen:Os,follow:Ds,state:Zs,fadeIn:Ws,mask:_s,drawon:$s,tile:Ci,agent:nr,on:_e,onUpdate:yn,onDraw:vn,onAdd:Bi,onDestroy:ys,onClick:xn,onCollide:vs,onCollideUpdate:xs,onCollideEnd:Vs,onHover:bs,onHoverUpdate:Ss,onHoverEnd:Es,onKeyDown:A.onKeyDown,onKeyPress:A.onKeyPress,onKeyPressRepeat:A.onKeyPressRepeat,onKeyRelease:A.onKeyRelease,onMouseDown:A.onMouseDown,onMousePress:A.onMousePress,onMouseRelease:A.onMouseRelease,onMouseMove:A.onMouseMove,onCharInput:A.onCharInput,onTouchStart:A.onTouchStart,onTouchMove:A.onTouchMove,onTouchEnd:A.onTouchEnd,onScroll:A.onScroll,onHide:A.onHide,onShow:A.onShow,onGamepadButtonDown:A.onGamepadButtonDown,onGamepadButtonPress:A.onGamepadButtonPress,onGamepadButtonRelease:A.onGamepadButtonRelease,onGamepadStick:A.onGamepadStick,mousePos:qt,mouseDeltaPos:A.mouseDeltaPos,isKeyDown:A.isKeyDown,isKeyPressed:A.isKeyPressed,isKeyPressedRepeat:A.isKeyPressedRepeat,isKeyReleased:A.isKeyReleased,isMouseDown:A.isMouseDown,isMousePressed:A.isMousePressed,isMouseReleased:A.isMouseReleased,isMouseMoved:A.isMouseMoved,isGamepadButtonPressed:A.isGamepadButtonPressed,isGamepadButtonDown:A.isGamepadButtonDown,isGamepadButtonReleased:A.isGamepadButtonReleased,getGamepadStick:A.getGamepadStick,charInputted:A.charInputted,loop:Mn,wait:lr,play:Mt,volume:lt,burp:Bt,audioCtx:j.ctx,Line:jt,Rect:Re,Circle:Vr,Polygon:_t,Vec2:S,Color:oe,Mat4:ke,Quad:ve,RNG:Or,rand:ii,randi:rs,randSeed:jr,vec2:B,rgb:se,hsl2rgb:Dn,quad:pe,choose:Lr,chance:Ur,lerp:it,tween:Ni,easings:fi,map:gt,mapc:Nr,wave:Ji,deg2rad:Qe,rad2deg:Ut,clamp:tt,testLineLine:Ot,testRectRect:Gr,testRectLine:Hr,testRectPoint:si,testCirclePolygon:qr,testLinePoint:Kr,testLineCircle:ns,drawSprite:ri,drawText:Ri,formatText:ct,drawRect:Ve,drawLine:f,drawLines:V,drawTriangle:M,drawCircle:X,drawEllipse:_,drawUVQuad:Ye,drawPolygon:we,drawFormattedText:dt,drawMasked:Ht,drawSubtracted:Kt,pushTransform:ge,popTransform:ce,pushTranslate:ne,pushScale:qe,pushRotate:ae,pushMatrix:It,usePostEffect:Tt,makeCanvas:Lt,debug:he,scene:er,go:tr,onSceneLeave:ir,addLevel:rr,getData:sr,setData:Ii,download:xi,downloadJSON:Wr,downloadText:hs,downloadBlob:ts,plug:Fi,ASCII_CHARS:Mr,canvas:A.canvas,addKaboom:ur,LEFT:S.LEFT,RIGHT:S.RIGHT,UP:S.UP,DOWN:S.DOWN,RED:oe.RED,GREEN:oe.GREEN,BLUE:oe.BLUE,YELLOW:oe.YELLOW,MAGENTA:oe.MAGENTA,CYAN:oe.CYAN,WHITE:oe.WHITE,BLACK:oe.BLACK,quit:vr,Event:Ge,EventHandler:$t,EventController:Nt};if(e.plugins&&e.plugins.forEach(Fi),e.global!==!1)for(let i in St)window[i]=St[i];return e.focus!==!1&&A.canvas.focus(),St},"default");var fo=.3,ls=new AudioContext,An=(e=1,t=.05,r=220,l=0,d=0,m=.1,E=0,I=1,U=0,A=0,Z=0,R=0,z=0,y=0,J=0,ue=0,j=0,D=1,ie=0,P=0,x=0)=>{let L=Math,K=2*L.PI,q=44100,de=U*=500*K/q/q,Oe=r*=(1-t+2*t*L.random(t=[]))*K/q,Me=0,st=0,le=0,Ce=1,je=0,wt=0,xe=0,Se=x<0?-1:1,ze=K*Se*x*2/q,rt=L.cos(ze),He=L.sin,nt=He(ze)/4,Ke=1+nt,At=-2*rt/Ke,ot=(1-nt)/Ke,Xe=(1+Se*rt)/2/Ke,yt=-(Se+rt)/Ke,Je=Xe,at=0,ht=0,Ze=0,lt=0;for(l=q*l+9,ie*=q,d*=q,m*=q,j*=q,A*=500*K/q**3,J*=K/q,Z*=K/q,R*=q,z=q*z|0,e*=fo,Se=l+ie+d+m+j|0;le<Se;t[le++]=xe*e)++wt%(100*ue|0)||(xe=E?1<E?2<E?3<E?He(Me**3):L.max(L.min(L.tan(Me),1),-1):1-(2*Me/K%2+2)%2:1-4*L.abs(L.round(Me/K)-Me/K):He(Me),xe=(z?1-P+P*He(K*le/z):1)*(xe<0?-1:1)*L.abs(xe)**I*(le<l?le/l:le<l+ie?1-(le-l)/ie*(1-D):le<l+ie+d?D:le<Se-j?(Se-le-j)/m*D:0),xe=j?xe/2+(j>le?0:(le<Se-j?1:(Se-le)/j)*t[le-j|0]/2/e):xe,x&&(xe=lt=Je*at+yt*(at=ht)+Xe*(ht=xe)-ot*Ze-At*(Ze=lt))),ze=(r+=U+=A)*L.cos(J*st++),Me+=ze+ze*y*He(le**5),Ce&&++Ce>R&&(r+=Z,Oe+=Z,Ce=0),!z||++je%z||(r=Oe,U=de,Ce=Ce||1);e=ls.createBuffer(1,Se,q),e.getChannelData(0).set(t),r=ls.createBufferSource(),r.buffer=e,r.connect(ls.destination),r.start()};var W={color:{gold:[222,158,65],accent:[165,48,48],fill:[23,32,56],life:[117,167,67],dust:[87,114,119],hit:[222,158,65],natural:[255,255,255],effect:[207,87,60],sting:[165,48,48]},colorLuck:[[79,143,186],[117,167,67],[192,148,115],[190,119,43],[162,62,140]],colorFailure:[[168,181,178],[199,207,204],[21,29,40]],font:"PixelifySans-Regular",bottleName:"bottle",skullName:"skull",winnerName:"winner",loserName:"loser",bonusName:"bonus",ingredientNames:["carrot","beetroot","acorn","amanita","onion","tooth"],amountIngredients:{min:1,max:10},maxBottles:10,bonusSpawnTime:60,scene:{size:{width:800,height:600},id:"game",scale:1,frequencySpawn:2,gravity:1600},shortSounds:{pot:[4.2,0,55,.02,.01,.16,1,1.9,17,28,,,,,,.1,,.63,.01,,-300],vapor:[,0,100,.12,.1,,4,.3,6,,250,-.05,.03,.3,,,.12,.5,,.02],done:[.8,0,100,.9,.26,.22,1,,,,233,.06,.08,1,,,1,.68,,,242],damage:[.5,0,100,,.06,.26,2,1.6,,,,,,,,,,.87,.07],bonus:[,0,200,.5,.25,.35,,10,-1,-42,11,,.3,,,,1,.52,.3,,155]}};function po(e,t){this.tags=t,this._collection=[],this.size={width:64,height:64},this.scale=.8,this.gravityScale=.1,this.collider={position:{x:15,y:12},size:{width:35,height:35}},this.damageHero=10,this.top=2,this.createSprites=function(){this.tags.forEach(r=>{this._collection.push(e.loadSprite(r,`sprites/${r}.png`))})},this.spawn=function(r){e.loop(r,()=>{let l=this.tags[e.randi(this.tags.length)],d=e.add([e.sprite(l),e.scale(this.scale),e.pos(e.rand(this.size.width,e.width()-this.size.width),-this.size.height*this.top),e.area({shape:new e.Rect(e.vec2(this.collider.position.x,this.collider.position.y),this.collider.size.width,this.collider.size.height)}),e.body({gravityScale:this.gravityScale}),{forename:l}]);d.onCollide(()=>{d.destroy(d)})})}}function go(e){this.tag="ground",this._span=0,this.size={width:64,height:64},this.isStatic=!0,this._locationZ=-10,this.createSprite=function(){e.loadSprite(this.tag,`sprites/${this.tag}.png`)},this.calculateSpan=function(t){this._span=Math.ceil(t/this.size.width)},this.helperPlatform=function(t){e.add([e.pos(0,e.height()-this.size.height),e.rect(e.width(),this.size.width),e.color(t),e.area(),e.body({isStatic:!0}),e.z(this._locationZ),{forename:this.tag}])},this.create=function(t){for(let r=0;r<this._span;r++)e.add([e.sprite(this.tag),e.pos(r*this.size.width,t-this.size.width),e.area(),e.body({isStatic:this.isStatic}),this.tag,{forename:this.tag}])}}function mo(e){this.tag="background",this.scale=2,this.createSprite=function(){e.loadSprite(this.tag,`sprites/${this.tag}.png`)},this.create=function(){e.add([e.sprite(this.tag),e.scale(this.scale),e.pos(0,0)])}}function wo(e,t){this.tag="hero",this.gameObject=null,this.scale=2,this.fullHealth=100,this.body={gravityScale:2,maxVelocity:700,jumpForce:800},this.speed=100,this.maxSpeed=this.speed*2,this._cutting={sliceX:6,sliceY:3,anims:{idle:{from:0,to:5,loop:!0,speed:4},run:{from:6,to:11,loop:!0},jump:{from:12,to:17}}},this._initialPosition={x:0,y:0},this._size={width:64,height:64},this.colliderPlayer={pos:{x:7,y:0},size:{width:20,height:this._size.height}},this.colliderAccessory={pos:{x:30,y:30},size:{width:25,height:15},offset:{x:2,y:0}},this.accessoryName="pot",this.turnCorrectionStatus={right:!1,left:!0},this.turnColliderRelocation={left:{parent:38,child:6},right:{parent:7,child:30}},this._potion=0,this._restrictMove={left:void 0,right:void 0},this.createSprite=function(){e.loadSprite(this.tag,`sprites/${this.tag}.png`,this._cutting)},this.create=function(){this.gameObject=e.add([e.sprite(this.tag,{anim:"idle"}),e.scale(this.scale),e.pos(this._initialPosition.x,this._initialPosition.y),e.timer(),e.area({shape:new e.Rect(e.vec2(this.colliderPlayer.pos.x,this.colliderPlayer.pos.y),this.colliderPlayer.size.width,this.colliderPlayer.size.height)}),e.body(this.body),e.health(this.fullHealth),e.color(t),this.tag,{forename:this.tag,bottlePoison:0}])},this.addPot=function(r){this.gameObject.add([e.pos(0,0),e.area({shape:new e.Rect(e.vec2(this.colliderAccessory.pos.x,this.colliderAccessory.pos.y),this.colliderAccessory.size.width,this.colliderAccessory.size.height),offset:e.vec2(this.colliderAccessory.offset.x,0),collisionIgnore:r}),e.body({isStatic:!0}),{forename:this.accessoryName,collectedIngredients:{carrot:0,beetroot:0,acorn:0,amanita:0,onion:0,tooth:0}}])},this.calculateInitialPosition=function(r,l){return this._initialPosition.x=r/2-this._size.width,this._initialPosition.y=l-this._size.height*3,this._initialPosition},this.turnStatusSwitch=function(){this.turnCorrectionStatus.right=!this.turnCorrectionStatus.right,this.turnCorrectionStatus.left=!this.turnCorrectionStatus.left},this.makingPotions=function(r){let l={potion:this._potion,reboot:!1,newRecipe:!1},d=this.gameObject.children[0].collectedIngredients,m=0;for(let E of Object.keys(r)){if(d[E]===r[E])m+=1;else if(d[E]>r[E]){for(let I of Object.keys(d))d[I]=0;return l.reboot=!0,l}if(m===Object.keys(r).length){for(let I of Object.keys(d))d[I]=0;return this._potion+=1,l.potion=this._potion,l.newRecipe=!0,l}}return l},this.calculateRestrict=function(r){return this._restrictMove.right=r-(this._size.width*this.scale-16),this._restrictMove.left=r-(r+16),this._restrictMove}}function Ao(e,t){this._pictureTitleSize={width:350,height:128},this._positionalPictureTitle={x:0,y:0},this._pictureControlSize={width:85,height:115},this._fontName=t.font,this._styleText={size:30,width:500,align:"center"},this._positionalText={x:0,y:0},this._color=t.color,this._picturesNames=["title","control"],this.scale=2,this.pictureControlIdent={x:100,y:115},this.dialogPosition={position:{x:200,y:390},step:60},this.dialog={start:"[gold]To start the game Press[/gold] [accent]ENTER[/accent]",moving:"[gold]Moving[/gold]",jump:"[gold]Jump[/gold]",restart:"[gold]Restart[/gold]"},this.create=function(){for(let r of this._picturesNames)e.loadSprite(r,`sprites/${r}.png`);return this._picturesNames},this.fontCreate=function(){e.loadFont(`${this._fontName}`,`fonts/${this._fontName}.ttf`)},this.getColorText=function(){return this._styleText.font=this._fontName,this._styleText.styles={gold:(r,l)=>({color:e.rgb(this._color.gold)}),accent:(r,l)=>({color:e.rgb(this._color.accent)})},this._styleText},this.calculateTextPosition=function(){this._positionalText.x=t.scene.size.width/2-this._styleText.width/2,this._positionalText.y=t.scene.size.height/2-30},this.calculatePicturePosition=function(){return this._positionalPictureTitle.x=(t.scene.size.width-this._pictureTitleSize.width)/10,this._positionalPictureTitle},this.banner=function(){e.add([e.sprite(this._picturesNames[0]),e.scale(this.scale),e.pos(this._positionalPictureTitle.x,this._positionalPictureTitle.y)])},this.textContinue=function(r){e.add([e.pos(this._positionalText.x,this._positionalText.y),e.text(this.dialog.start,r)])},this.control=function(){e.add([e.sprite(this._picturesNames[1]),e.pos(this._positionalText.x+this.pictureControlIdent.x,this._positionalText.y+this.pictureControlIdent.y),e.scale(this.scale*.7)])},this.descriptionControl=function(){for(let r of Object.keys(this.dialog).slice(1))e.add([e.pos(this.dialogPosition.position.x,this.dialogPosition.position.y),e.text(this.dialog[r],this.getColorText())]),this.dialogPosition.position.y+=this.dialogPosition.step}}function yo(e,t){this._color=t.color,this._fontName=t.font,this.layerIngredientScale=null,this._texts=[],this.layerBottlePoison=null,this.bottlesCountText=null,this._bottleName=t.bottleName,this._skullName=t.skullName,this._layerSkull=null,this.healthBar=null,this._healthBarBackground=null,this._healthBarForeground=null,this.healthBarLength=135,this._healthBarSettings={width:this.healthBarLength,height:20,position:{x:t.scene.size.width-143,y:10}},this._locationZ=100,this.decreaseHealthBar=void 0,this._size={width:64,height:64},this.winner=t.winnerName,this.loser=t.loserName,this.createImageSessionResult=function(){e.loadSprite(this.winner,`sprites/${this.winner}.png`),e.loadSprite(this.loser,`sprites/${this.loser}.png`)},this.calculationHealthBarReduction=function(r){this.decreaseHealthBar=this.healthBarLength/r},this.createLayerSkull=function(){this._layerSkull=e.add([e.fixed(),e.z(this._locationZ)])},this.createLayerIngredientScale=function(){this.layerIngredientScale=e.add([e.fixed(),e.z(this._locationZ)])},this.createLayerBottlePoison=function(){this.layerBottlePoison=e.add([e.fixed(),e.z(this._locationZ)])},this.displaySkull=function(r=this._color.natural){this._layerSkull.add([e.sprite(this._skullName),e.scale(.8),e.pos(e.width()-this._size.width*3,-5),e.color(r)])},this.drawHealthBarBackground=function(){this._healthBarBackground=e.add([e.rect(this._healthBarSettings.width,this._healthBarSettings.height),e.pos(this._healthBarSettings.position.x,this._healthBarSettings.position.y),e.color(this._color.accent),e.z(this._locationZ)])},this.drawHealthBarForeground=function(r){this.healthBarForeground=e.add([e.rect(r,this._healthBarSettings.height),e.pos(this._healthBarSettings.position.x,this._healthBarSettings.position.y),e.color(this._color.life),e.z(this._locationZ)])},this.createIngredientUI=function(r,l,d){d.size=20,d.width=200,d.align="left";let m=30,E=0;for(let I of Object.keys(r)){this.layerIngredientScale.add([e.sprite(I),e.scale(.4),e.pos(10,m*E)]);let U=this.layerIngredientScale.add([e.pos(40,(m+1.2)*E),e.text(`[gold]${l[I]}/${r[I]}[/gold]`,d)]),A={};A[I]=U,this._texts.push(A),++E}},this.refreshIngredientDisplay=function(r,l,d){for(let m of this._texts)Object.keys(m)[0]===r&&(m[r].text=`[gold]${l[r]}/${d[r]}[/gold]`)},this.createSkull=function(){e.loadSprite(this._skullName,`sprites/${this._skullName}.png`)},this.createBottlePoison=function(){e.loadSprite(this._bottleName,`sprites/${this._bottleName}.png`)},this.displayBottlePoisons=function(r){this.layerBottlePoison.add([e.sprite(this._bottleName),e.scale(.8),e.pos(e.width()-64*3,50)]),this.layerBottlePoison.add([e.text("[gold]x[/gold]",r),e.pos(e.width()-150,70)])},this.createCountingBottlePoisons=function(r,l,d){d.size=30,this.bottlesCountText=this.layerBottlePoison.add([e.text(`[gold]${r}/${l}[/gold]`,d),e.pos(e.width()-135,67)])},this.getSkull=function(){return this._layerSkull},this.redrawSkull=function(r=this._color.natural){e.destroy(this._layerSkull),this.createLayerSkull(),this.displaySkull(r)}}function vo(e,t,r){this._ingredients=t,this._recipe={},this.create=function(){for(let l of this._ingredients)this._recipe[l]=e.randi(r.min,r.max+1)},this.getRecipe=function(){return this._recipe}}function xo(){this.displayText=function(e,t,r){r.size=60,r.width=350,e.add([e.pos(250,50),e.text(t,r)])},this.displayImage=function(e,t){e.add([e.sprite(t),e.pos((e.width()-256)/2,160),e.scale(4)])},this.playOverText=function(e,t,r){r.size=30,r.width=700,e.add([e.pos(150,450),e.text(`[gold]To start the game again. Press[/gold] [accent]${t}[/accent]`,r)])}}function Vo(e,t,r){this.tag=t,this.sprite=null,this.gameObject=null,this.numbersRandomPosition={from:64,to:700},this.spawnTime=r,this.colliderSetting={position:{x:15,y:15},size:{width:32,height:30}},this.isStatic=!0,this.scale=1,this.locationZ=1,this.distanceToGround=472,this.createSprite=function(){this.sprite=e.loadSprite(this.tag,`sprites/${this.tag}.png`)},this.spawn=function(l){e.wait(this.spawnTime,()=>{let d=e.randi(this.numbersRandomPosition.from,this.numbersRandomPosition.to+1),m=l.playerPositionRange.start,E=l.playerPositionRange.end,I=Math.max(m,E);Math.min(m,E)<=d&&d<=I?this.spawn(l):(this.gameObject=e.add([e.sprite(this.sprite),e.area({shape:new e.Rect(e.vec2(this.colliderSetting.position.x,this.colliderSetting.position.y),this.colliderSetting.size.width,this.colliderSetting.size.height)}),e.body({isStatic:this.isStatic}),e.scale(this.scale),e.z(this.locationZ),e.pos(d,this.distanceToGround),this.tag,{forename:this.tag}]),this.gameObject.onCollide(Z=>{Z.forename===l.playerName&&(e.destroy(this.gameObject),this.spawn(l))}))})}}function bo(e,t){this.dustName="dust",this.starsName="star",this.vaporName="vapor",this.createDust=function(r,l){e.add([e.pos(r),e.rect(7,7),e.color(t.color.dust),e.anchor("center"),e.scale(e.rand(.3,.6)),e.opacity(.2),e.lifespan(.2,{fade:.1}),e.move(l,e.rand(60,120)),{forename:this.dustName}])},this.createStart=function(r){let l=[e.LEFT,e.UP,e.RIGHT,e.DOWN,e.vec2(1,1),e.vec2(-1,-1),e.vec2(1,-1),e.vec2(-1,1)];for(let d=0;d<l.length;d++)e.add([e.pos(r),e.rect(8,8),e.color(t.color.hit),e.anchor("center"),e.scale(e.rand(.4,.6)),e.opacity(.7),e.lifespan(.2,{fade:.1}),e.move(l[d],e.rand(90,100)),e.rotate(e.rand(-360,360)),{forename:this.starsName}])},this.repaint=function(r){r.color=e.rgb(t.color.sting),r.wait(.08,()=>{r.color=e.rgb(t.color.natural)})},this.vaporPot=function(r,l,d=3,m={min:3,max:7},E={min:.4,max:.9},I={destroy:.1,fading:.2},U={min:150,max:256}){let A=r.x,Z=r.y;for(let R=0;R<d;R++)e.add([e.pos(e.rand(A,A+20),Z),e.circle(e.rand(m.min,m.max)),e.color(e.choose(l)),e.anchor("center"),e.scale(e.rand(E.min,E.max)),e.opacity(.5),e.lifespan(I.destroy,{fade:I.fading}),e.move(e.UP,e.rand(U.min,U.max)),{forename:this.vaporName}])}}function So(e){this.tag="enemy",this.sprite=null,this.gameObject=null,this.pointsSpawn=[-70,850],this.speed=220,this.dir=1,this.currentPoint=void 0,this.createSprite=function(){this.sprite=e.loadSprite(this.tag,`sprites/${this.tag}.png`,{sliceX:6,anims:{run:{from:0,to:5,loop:!0,speed:12}}})},this.spawn=function(){this.currentPoint=this.pointsSpawn[e.randi(0,2)],this.gameObject=e.add([e.sprite(this.sprite,{anim:"run"}),e.pos(this.currentPoint,473),e.area({shape:new e.Rect(e.vec2(20,44),32,20),collisionIgnore:["ground","bonus"]}),e.offscreen({hide:!0,distance:50}),e.opacity(0),e.z(100),{forename:this.tag}])},this.move=function(){let t=e.randi(4,9);e.wait(t,()=>{this.gameObject.opacity=1,dir=this.currentPoint>400?-1:1,this.gameObject.flipX=dir<0,this.gameObject.onUpdate(()=>{dir<0&&Math.ceil(this.gameObject.pos.x)>Math.min(...this.pointsSpawn)||dir>0&&Math.ceil(this.gameObject.pos.x)<Math.max(...this.pointsSpawn)?this.gameObject.move(this.speed*dir,0):(this.gameObject.destroy(),this.spawn(),this.move())})})}}function Eo(e){this.playSound=function(t){e(...t)}}function Ro(e){this.melody=null,this.melodiesData={bgmusic:null,winner:null,loser:null},this.createMelodies=function(){for(key of Object.keys(this.melodiesData))this.melodiesData[key]=e.loadSound(key,`music/${key}.ogg`)},this.playMelody=function(t,r){this.melody=e.play(t,{loop:r})}}(function(){let t=wn({width:W.scene.size.width,height:W.scene.size.height,canvas:document.getElementById(W.scene.id),scale:W.scene.scale,global:!1,background:W.color.fill});t.debug.inspect=!1;let r={textStyle:null,ground:void 0,ingredientDamage:void 0,bonusName:void 0,bonusSpawnTime:void 0,playerName:void 0,playerPositionRange:{start:0,end:0},dustName:void 0,starName:void 0,enemyName:void 0},l=new Ro(t);l.createMelodies(),t.scene("start",()=>{let d=new Ao(t,W);d.create(),d.fontCreate(),d.calculateTextPosition(),d.calculatePicturePosition();let m=d.getColorText();r.textStyle=m,d.banner(),d.textContinue(m),d.control(),d.descriptionControl(),t.onKeyPress("enter",()=>{t.go("main")})}),t.go("start"),t.scene("main",()=>{l.playMelody(l.melodiesData.bgmusic,!0),t.setGravity(W.scene.gravity),t.onKeyPress("r",()=>{t.go("main"),l.melody.stop()});let d=new Eo(An),m=new vo(t,W.ingredientNames,W.amountIngredients);m.create();let E=m.getRecipe(),I=new bo(t,W);r.dustName=I.dustName,r.starName=I.starsName;let U=new So(t);U.createSprite(),U.spawn(),U.move(),r.enemyName=U.tag;let A=new Vo(t,W.bonusName,W.bonusSpawnTime);r.bonusName=A.tag,r.bonusSpawnTime=A.spawnTime,A.createSprite(),A.spawn(r);let Z=new mo(t);Z.createSprite(),Z.create();let R=new po(t,W.ingredientNames);r.ingredientDamage=R.damageHero,R.createSprites(),R.spawn(W.scene.frequencySpawn);let z=new go(t);r.ground=z.tag,z.createSprite(),z.calculateSpan(W.scene.size.width),z.helperPlatform(W.color.fill),z.create(W.scene.size.height);let y=new yo(t,W);y.createLayerIngredientScale(),y.createLayerBottlePoison(),y.createBottlePoison(),y.createSkull(),y.createLayerSkull(),y.displaySkull(),y.drawHealthBarBackground();let J=y.healthBarLength;y.drawHealthBarForeground(J),y.calculationHealthBarReduction(r.ingredientDamage),y.createImageSessionResult(),function(j,D,ie,P){let x=new wo(t,W.color.natural);x.createSprite();let L=x.calculateRestrict(W.scene.size.width);x.calculateInitialPosition(W.scene.size.width,W.scene.size.height),r.playerName=x.tag,x.create(),x.addPot([r.bonusName,r.playerName]),j.createIngredientUI(E,x.gameObject.children[0].collectedIngredients,r.textStyle),j.displayBottlePoisons(r.textStyle),j.createCountingBottlePoisons(x.gameObject.bottlePoison,W.maxBottles,r.textStyle),x.gameObject.children[0].onCollide(K=>{x.gameObject.children[0].collectedIngredients[K.forename]+=1;let q=x.makingPotions(E);x.gameObject.bottlePoison=q.potion,j.refreshIngredientDisplay(K.forename,x.gameObject.children[0].collectedIngredients,E);let de=x.gameObject.flipX?t.vec2(40,65):t.vec2(75,65);q.reboot?(t.destroy(j.layerIngredientScale),j.createLayerIngredientScale(),j.createIngredientUI(E,x.gameObject.children[0].collectedIngredients,r.textStyle),D.vaporPot(x.gameObject.pos.add(de),W.colorFailure,25,{min:5,max:11},{min:.5,max:.8},{destroy:.3,fading:.2},{min:150,max:260}),ie.playSound(W.shortSounds.vapor)):q.newRecipe?(t.destroy(j.bottlesCountText),j.createCountingBottlePoisons(x.gameObject.bottlePoison,W.maxBottles,r.textStyle),m.create(t),E=m.getRecipe(),t.destroy(j.layerIngredientScale),j.createLayerIngredientScale(t),j.createIngredientUI(E,x.gameObject.children[0].collectedIngredients,r.textStyle),D.vaporPot(x.gameObject.pos.add(de),W.colorLuck,20,{min:10,max:15},{min:.6,max:.9},{destroy:.8,fading:.6},{min:150,max:365}),x.gameObject.bottlePoison===W.maxBottles?(P.melody.stop(),t.go("inform","[gold]You Winner[/gold]",j.winner,P,"winner")):ie.playSound(W.shortSounds.done)):(D.vaporPot(x.gameObject.pos.add(de),[W.color.life]),ie.playSound(W.shortSounds.pot))}),x.gameObject.onCollide(K=>{if(K.forename===r.bonusName&&x.speed!==x.maxSpeed){j.redrawSkull(W.color.effect),ie.playSound(W.shortSounds.bonus);let q=2;x.speed=x.maxSpeed,x.gameObject.wait(r.bonusSpawnTime/q,()=>{j.redrawSkull(),x.speed=x.speed/q})}if(K.forename!==r.ground&&K.forename!==r.bonusName&&K.forename!==r.dustName&&K.forename!==r.starName){x.gameObject.hurt(r.ingredientDamage),t.destroy(j.healthBarForeground),j.drawHealthBarForeground(j.healthBarLength-=j.decreaseHealthBar),j.healthBarLength>0&&ie.playSound(W.shortSounds.damage);let q=t.vec2(88,15);x.gameObject.flipX||(q.x=q.x/2),K.forename!==r.enemyName&&D.createStart(x.gameObject.pos.add(q)),D.repaint(x.gameObject)}}),x.gameObject.onDeath(()=>{P.melody.stop(),t.go("inform","[accent]Game Over[/accent]",j.loser,P,"loser")}),x.gameObject.onKeyDown("left",()=>{x.gameObject.pos.x>L.left&&(r.playerPositionRange.start=Math.ceil(x.gameObject.pos.x)+100,r.playerPositionRange.end=Math.ceil(x.gameObject.pos.x)-100,x.gameObject.flipX=!0,x.gameObject.move(-x.speed,0),x.gameObject.area.shape.pos.x=x.turnColliderRelocation.left.parent,x.gameObject.children[0].area.shape.pos.x=x.turnColliderRelocation.left.child,x.gameObject.isGrounded()&&!t.isKeyDown("right")&&(D.createDust(x.gameObject.pos.add(87,t.rand(125,130)),t.RIGHT),D.createDust(x.gameObject.pos.add(100,t.rand(123,129)),t.RIGHT)))}),x.gameObject.onKeyDown("right",()=>{x.gameObject.flipX=!1,x.gameObject.pos.x<L.right&&(r.playerPositionRange.start=Math.ceil(x.gameObject.pos.x)-100,r.playerPositionRange.end=Math.ceil(x.gameObject.pos.x)+100,x.gameObject.move(x.speed,0),x.gameObject.area.shape.pos.x=x.turnColliderRelocation.right.parent,x.gameObject.children[0].area.shape.pos.x=x.turnColliderRelocation.right.child,x.gameObject.isGrounded()&&!t.isKeyDown("left")&&(D.createDust(x.gameObject.pos.add(31,t.rand(125,130)),t.LEFT),D.createDust(x.gameObject.pos.add(40,t.rand(123,129)),t.LEFT)))}),x.gameObject.onKeyPress("space",()=>{x.gameObject.isGrounded()&&x.gameObject.jump()}),["left","right","space"].forEach(K=>{K=="space"?x.gameObject.onKeyPress(K,()=>{x.gameObject.play("jump")}):K=="right"?x.gameObject.onKeyPress(K,()=>{x.gameObject.play("run"),x.turnCorrectionStatus[K]&&(x.gameObject.pos.x=x.gameObject.pos.x+x.gameObject.width,x.turnStatusSwitch())}):K=="left"&&x.gameObject.onKeyPress(K,()=>{x.gameObject.play("run"),x.turnCorrectionStatus[K]&&(x.gameObject.pos.x=x.gameObject.pos.x-x.gameObject.width,x.turnStatusSwitch())})}),x.gameObject.onKeyRelease(()=>{!t.isKeyDown("left")&&!t.isKeyDown("right")&&!t.isKeyDown("space")?x.gameObject.play("idle"):t.isKeyDown("right")||t.isKeyDown("left")?x.gameObject.play("run"):t.isKeyDown("space")&&x.gameObject.isGrounded()&&x.gameObject.play("idle")}),x.gameObject.onUpdate(()=>{(t.isKeyDown("right")&&t.isKeyDown("space")&&x.gameObject.isGrounded()&&x.gameObject.curAnim()!=="run"||t.isKeyDown("left")&&t.isKeyDown("space")&&x.gameObject.isGrounded()&&x.gameObject.curAnim()!=="run")&&x.gameObject.play("run"),(x.gameObject.pos.x>L.right&&x.gameObject.curAnim()!=="idle"||x.gameObject.pos.x<L.left&&x.gameObject.curAnim()!=="idle")&&x.gameObject.play("idle"),t.isKeyDown("right")&&t.isKeyDown("left")&&x.gameObject.curAnim()!=="idle"&&x.gameObject.play("idle")})}(y,I,d,l)}),t.scene("inform",(d,m,E,I)=>{E.playMelody(E.melodiesData[I],!1),t.onKeyPress("r",()=>{E.melody.stop(),t.go("main")});let U=new xo;U.displayText(t,d,r.textStyle),U.displayImage(t,m),U.playOverText(t,"R",r.textStyle)})})();})();
